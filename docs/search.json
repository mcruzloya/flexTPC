[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "A flexible model for thermal performance curves",
    "section": "",
    "text": "FlexTPC is a mathematical model for thermal performance curves that aims to be both flexible and interpretable. We show an interactive visualization of flexTPC and its parameters below:\nviewof T_min = Inputs.range(\n  [-5, 20], \n  {value: 10, step: 0.2, label: \"Tmin:\"}\n)\nviewof T_max = Inputs.range(\n  [30, 50], \n  {value: 35, step: 0.2, label: \"Tmax:\"}\n)\n\nviewof r_max = Inputs.range(\n  [0, 1.2], \n  {value: 1, step: 0.1, label: \"rmax:\"}\n)\n\nviewof alpha = Inputs.range(\n  [0, 1], \n  {value: 0.8, step: 0.02, label: \"alpha:\"}\n)\n\nviewof beta = Inputs.range(\n  [0, 1], \n  {value: 0.3, step: 0.02, label: \"beta:\"}\n)\nfunction incrementalArray(start, end, step) {\n    var arr = [];\n    // convert count to an integer to avoid rounding errors\n    var count = +((end - start) / step).toFixed();\n    for (var j = 0; j &lt;= count; j++) {\n        var i = start + j * step;\n        arr.push(i);\n    }\n    return arr;\n}\n\nfunction flexTPC(x, T_min, T_max, r_max, alpha, beta) {\n  if (x &lt; T_min) {\n  return 0.0\n  }\n  if (x &gt; T_max) {\n  return 0.0\n  }\n  return r_max * Math.exp((alpha * (1.0 - alpha) / beta**2) * (alpha *    Math.log( (x - T_min) / alpha)  + \n      (1.0 - alpha) * Math.log( (T_max - x) / (1.0 - alpha)) -\n      Math.log(T_max - T_min)))\n}\n\nxvals = incrementalArray(-5, 50, 0.1)\nyvals = xvals.map((x) =&gt; flexTPC(x, T_min, T_max, r_max, alpha, beta))\nzip = (a, b) =&gt; a.map((k, i) =&gt; [k, b[i]]);\ndata = zip(xvals, yvals)\n\nPlot.plot({\n  width: 600,\n  height: 400,\n  y: { domain: [-0.01, 1.25] },\n  marks: [\n    Plot.line(\n      data,\n      {\n        strokeWidth: 3,\n        stroke: \"steelblue\",\n        fontSize: 14\n      }\n    ),\n    Plot.ruleX([0]),\n    Plot.ruleY([0]),\n    Plot.axisX({label: \"Temperature [°C]\", fontSize: 14, marginBottom: 40}),\n    Plot.axisY({label: \"trait performance\", fontSize: 14, x: 0 })\n  ]\n})\nFlexTPC is parametrized in terms of biologically interpretable quantities:"
  },
  {
    "objectID": "index.html#r-code",
    "href": "index.html#r-code",
    "title": "A flexible model for thermal performance curves",
    "section": "R code",
    "text": "R code\nFor convenience, we provide R functions that implement the flexTPC model below:\n\n# FlexTPC model for thermal performance curves.\n# (parametrized with alpha/beta)\nflexTPC &lt;- function(temp, Tmin, Tmax, rmax, alpha, beta) {\n  s &lt;- alpha * (1 - alpha) / beta^2\n  result &lt;- rep(0, length(temp))\n  Tidx = (temp &gt; Tmin) & (temp &lt; Tmax)\n  result[Tidx] &lt;- rmax * exp(s * (alpha * log( (temp[Tidx] - Tmin) / alpha) \n                  + (1 - alpha) * log( (Tmax - temp[Tidx]) / (1 - alpha)) \n                  - log(Tmax - Tmin)) ) \n  return(result)\n}\n  \n# FlexTPC model for thermal performance curves.\n# (parametrized with Topt/B)\nflexTPC2 &lt;- function(temp, Tmin, Tmax, rmax, Topt, B) {\n  alpha &lt;- (Topt - Tmin) / (Tmax - Tmin)\n  beta &lt;- B / (Tmax - Tmin)\n  return(flexTPC(temp, Tmin, Tmax, rmax, alpha, beta))\n}"
  },
  {
    "objectID": "index.html#reference",
    "href": "index.html#reference",
    "title": "A flexible model for thermal performance curves",
    "section": "Reference",
    "text": "Reference\nIf you use flexTPC, please cite\nCruz-Loya M, Mordecai EA, Savage VM. 2024. A flexible model for thermal performance curves. (biorXiv preprint) (data and code)"
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "About this site\n\n1 + 1\n\n[1] 2"
  },
  {
    "objectID": "rflexTPC/Visualization.html",
    "href": "rflexTPC/Visualization.html",
    "title": "Restricted models from flexTPC equation",
    "section": "",
    "text": "import numpy as np\n\nfrom bokeh.plotting import figure, show\nfrom bokeh.io import output_notebook, curdoc\nfrom bokeh.models import ColumnDataSource, Slider\nfrom bokeh.layouts import column, row, layout\n\nfrom matplotlib import pyplot as plt\n\n\ndef flexTPC(T, Tmin=10, Tmax=35, rmax=1.0, α=0.8, β̃=0.2):\n    result = np.zeros(len(T))\n    Tidx = (T &gt; Tmin) & (T &lt; Tmax)\n    s = α * (1 - α) / β̃**2\n    result[Tidx] = rmax * np.exp(s * (α * np.log((T[Tidx] - Tmin) / α) +\n                                      (1 - α) * np.log((Tmax - T[Tidx]) / (1 - α)) - \n                                      np.log(Tmax - Tmin)))\n    return result\n\ndef rflexTPC(T, Tmin=10, Tmax=35, rmax=1.0, α=0.8):\n    β̃ = 1 / np.sqrt(8) - (1 / np.sqrt(8) - 0.2) * np.abs(α - 0.5) / 0.3\n    result = np.zeros(len(T))\n    Tidx = (T &gt; Tmin) & (T &lt; Tmax)\n    s = α * (1 - α) / β̃**2\n    result[Tidx] = rmax * np.exp(s * (α * np.log((T[Tidx] - Tmin) / α) +\n                                      (1.0 - α) * np.log((Tmax - T[Tidx]) / (1.0 - α)) - \n                                      np.log(Tmax - Tmin)))\n    return result\n\ndef rflexTPC_nd(τ, rmax=1.0, α=0.8):\n    β̃ = 1 / np.sqrt(8) - (1 / np.sqrt(8) - 0.2) * np.abs(α - 0.5) / 0.3\n    result = np.zeros(len(T))\n    s = α * (1 - α) / β̃**2\n    result = rmax * np.exp(s * (α * np.log(τ / α) +\n                                      (1.0 - α) * np.log((1.0 - τ) / (1.0 - α))))\n    return result\n\n\nT = np.arange(5, 40, 0.001)\nfor α in [0.1, 0.3, 0.5, 0.8, 0.9]:\n    plt.plot(T, rflexTPC(T, rmax=1, α=α), '-', label=f'α={α}')\nplt.xlabel('temperature')\nplt.ylabel('performance')\nplt.legend(loc='best')\nplt.show()\n\n\n\n\n\n\n\n\n\noutput_notebook()\n\n    \n    \n        \n        Loading BokehJS ...\n    \n\n\n\n\n\n\nT = np.arange(0, 40, 0.01)\n\nsource = ColumnDataSource(data=dict(x=T, y=flexTPC(T, rmax=2.0, α=0.5, β̃=1/np.sqrt(8))))\n\nplot = figure(height=400, width=400, title=\"flexTPC\",\n              tools=\"crosshair,pan,reset,save,wheel_zoom\",\n              x_range=[-5, 40], y_range=[0, 2.1], x_axis_label=r'$$T$$', y_axis_label=r'$$r(T)$$')\n# add a line renderer with legend and line thickness to the plot\nplot.line('x', 'y', source=source, line_width=3, line_alpha=1.0)\n\n# Set up widgets\nTmin_sl = Slider(title=r\"$$T_{\\min}$$\", value=10.0, start=-5.0, end=20.0, step=0.1)\nTmax_sl = Slider(title=r\"$$T_{\\max}$$\", value=35.0, start=25.0, end=50.0, step=0.1)\nrmax_sl = Slider(title=r\"$$r_{\\max}$$\", value=1.0, start=0.0, end=2.0, step=0.01)\nα_sl = Slider(title=r\"$$\\alpha$$\", value=0.5, start=0, end=1.0, step=0.01)\nβ̃_sl = Slider(title=r\"$$\\tilde{\\beta}$$\", value=0.35, start=0.0, end=1.0, step=0.01)\n\ndef update_data(attrname, old, new):\n    # Get the current slider values\n    Tmin = Tmin_sl.value\n    Tmax = Tmax_sl.value\n    rmax = rmax_sl.value\n    α = α_sl.value\n    β̃ = β̃_sl.value\n\n    # Generate the new curve\n    x = T\n    y = flexTPC(T, Tmin=Tmin, Tmax=Tmax, rmax=rmax, α=α, β̃=β̃)\n\n    source.data = dict(x=x, y=y)\n\nfor w in [Tmin_sl, Tmax_sl, rmax_sl, α_sl, β̃_sl]:\n    w.on_change('value', update_data)\n\n# Set up layouts and add to document\ninputs = column(Tmin_sl, Tmax_sl, rmax_sl, α_sl, β̃_sl)\n\nl = layout(\n    [\n        [plot, [Tmin_sl, Tmax_sl, rmax_sl, α_sl, β̃_sl]],\n    ],\n)\n\ncurdoc().add_root(row(inputs, plot, width=800))\ncurdoc().title = \"Sliders\"\n\nshow(l)\n\nWARNING:bokeh.embed.util:\nYou are generating standalone HTML/JS output, but trying to use real Python\ncallbacks (i.e. with on_change or on_event). This combination cannot work.\n\nOnly JavaScript callbacks may be used with standalone output. For more\ninformation on JavaScript callbacks with Bokeh, see:\n\n    https://docs.bokeh.org/en/latest/docs/user_guide/interaction/js_callbacks.html\n\nAlternatively, to use real Python callbacks, a Bokeh server application may\nbe used. For more information on building and running Bokeh applications, see:\n\n    https://docs.bokeh.org/en/latest/docs/user_guide/server.html\n\n\n\n\n  \n\n\n\n\n\n\ninputs = column(text, offset, amplitude, phase, freq)"
  },
  {
    "objectID": "model_comparison/Abcoli.html",
    "href": "model_comparison/Abcoli.html",
    "title": "Comparison of Briere models and flexTPC on antibiotic dataset",
    "section": "",
    "text": "import numpy as np\nimport pandas as pd\nimport random\n\nrandom.seed(42)\n\nfrom matplotlib import pyplot as plt\n\nfrom scipy.optimize import minimize\nfrom sklearn.model_selection import LeaveOneOut\ndef briere1(T, Tmin=10.0, Tmax=50.0, c=1.0):\n    result = np.zeros(len(T))\n    cond = (Tmin &lt; T) & (T &lt; Tmax)\n    result[cond] = c * T[cond] * np.exp(np.log(T[cond] - Tmin) + 0.5 * np.log(Tmax - T[cond]))\n    return result\n\ndef briere2(T, Tmin=10.0, Tmax=50.0, c=1.0, b=2.0):\n    result = np.zeros(len(T))\n    cond = (Tmin &lt; T) & (T &lt; Tmax)\n    result[cond] = c * T[cond] * np.exp(np.log(T[cond] - Tmin) +  np.log(Tmax - T[cond]) / b)\n    return result\n\n# Fully biologically interpretable parametrization of flexTPC model\ndef flexTPC(T, Tmin=10.0, Tmax=50.0, rmax=1.0, α=0.8, β=0.2):\n    result = np.zeros(len(T))\n    cond = (Tmin &lt; T) & (T &lt; Tmax)\n    s = α * (1.0 - α) / β**2\n    result[cond] = rmax * np.exp(s * (α * (np.log(T[cond] - Tmin) - np.log(α)) +\n                                      (1 - α) * (np.log(Tmax - T[cond]) - np.log(1 - α) )\n                                       - np.log(Tmax - Tmin)))\n    return result\ndef nloglik2(θ, Tdata, rdata, model=flexTPC):\n    params, σ2 = θ[:-1], θ[-1]\n    Tmin, Tmax = θ[:2]\n    outside = (Tdata &lt; Tmin) | (Tdata &gt; Tmax)\n    n = len(rdata)\n    return 0.5 * (n * np.log(2*np.pi*σ2) + np.sum((rdata - model(Tdata, *params))**2 / σ2))\n    \ndef AIC(nll, p):\n    return 2 * nll + 2 * p \n\ndef BIC(nll, n, p):\n    return 2 * nll + p * np.log(n)"
  },
  {
    "objectID": "model_comparison/Abcoli.html#e.-coli-antibiotics-dataset",
    "href": "model_comparison/Abcoli.html#e.-coli-antibiotics-dataset",
    "title": "Comparison of Briere models and flexTPC on antibiotic dataset",
    "section": "E. coli antibiotics dataset",
    "text": "E. coli antibiotics dataset\n\nabcoli = pd.read_csv(\"ab_data.csv\")\nsingle = abcoli[(abcoli[\"drug2name\"] == \"WT\")]\ndrugs = ['AMP',\n 'CLI',\n 'CPR',\n 'ERY',\n 'FOX',\n 'GEN',\n 'LVX',\n 'NTR',\n 'STR',\n 'TET',\n 'TMP',\n 'TOB',\n 'WT']\n\n\ndrugs\n\n['AMP',\n 'CLI',\n 'CPR',\n 'ERY',\n 'FOX',\n 'GEN',\n 'LVX',\n 'NTR',\n 'STR',\n 'TET',\n 'TMP',\n 'TOB',\n 'WT']\n\n\n\nsingle\n\n\n\n\n\n\n\n\ndrug1name\ndrug2name\ndrug1num\ndrug2num\nT\nt\nsample\nOD\n\n\n\n\n28\nNTR\nWT\n8.0\n13.0\n37.0\n24.0\n1.0\n0.6244\n\n\n29\nNTR\nWT\n8.0\n13.0\n37.0\n24.0\n2.0\n0.6865\n\n\n30\nNTR\nWT\n8.0\n13.0\n37.0\n24.0\n3.0\n0.7640\n\n\n31\nNTR\nWT\n8.0\n13.0\n37.0\n24.0\n4.0\n0.7984\n\n\n32\nNTR\nWT\n8.0\n13.0\n22.0\n24.0\n1.0\n0.0139\n\n\n...\n...\n...\n...\n...\n...\n...\n...\n...\n\n\n1927\nTET\nWT\n10.0\n13.0\n44.0\n24.0\n4.0\n0.3349\n\n\n1928\nTET\nWT\n10.0\n13.0\n30.0\n24.0\n1.0\n0.3772\n\n\n1929\nTET\nWT\n10.0\n13.0\n30.0\n24.0\n2.0\n0.3865\n\n\n1930\nTET\nWT\n10.0\n13.0\n30.0\n24.0\n3.0\n0.3883\n\n\n1931\nTET\nWT\n10.0\n13.0\n30.0\n24.0\n4.0\n0.4085\n\n\n\n\n364 rows × 8 columns\n\n\n\n\nabdata = single.groupby([\"drug1name\", \"T\"], as_index=False).agg({'OD':'mean'})\n#Set low values to zero\n\n#abdata[\"OD\"][abdata[\"OD\"] &lt; 0.02] = 0.0\n\n\nabdata[abdata[\"OD\"] &lt; 0.0]\n\n\n\n\n\n\n\n\ndrug1name\nT\nOD\n\n\n\n\n\n\n\n\n\n\nabdata[abdata[\"drug1name\"] == \"AMP\"]\n\n\n\n\n\n\n\n\ndrug1name\nT\nOD\n\n\n\n\n0\nAMP\n22.0\n0.255500\n\n\n1\nAMP\n25.0\n0.399700\n\n\n2\nAMP\n30.0\n0.717800\n\n\n3\nAMP\n37.0\n0.713775\n\n\n4\nAMP\n41.0\n0.625300\n\n\n5\nAMP\n44.0\n0.001950\n\n\n6\nAMP\n46.0\n0.002450\n\n\n\n\n\n\n\n\ndef nloglikab(θ, Tdata, rdata, model=flexTPC):\n    params, σ2 = θ[:-1], θ[-1]\n    Tmin, Tmax = θ[:2]\n    return 0.5 * (len(rdata) * np.log(2*np.pi*σ2) + np.sum((rdata \n                                                    - model(Tdata, *params))**2 / σ2))\n\n\ninitial_flex = {drug:[20.0, 46.5, 0.7, 0.7, 0.2, 0.005] for drug in drugs}\n#initial_mb[\"GEN\"] = [20.0, 46.5, 0.5, 0.7, 2.0, 0.005]\n#initial_mb[\"STR\"] = [20.0, 46.5, 0.5, 0.7, 2.0, 0.005]\n#initial_mb[\"TOB\"] = [20.0, 46.5, 0.5, 0.7, 2.0, 0.005]\n#initial_mb[\"ERY\"] = [20.0, 46.5, 0.5, 0.7, 4.0, 0.005]\n#initial_mb[\"AMP\"] = [15.0, 46.5, 0.7, 0.7, 2.0, 0.005]\n\ninitial_b1 = {drug:[20.0, 46.5, 3e-4, 0.005] for drug in drugs}\ninitial_b2 = {drug:[20.0, 46.5, 3e-4, 2.0, 0.005] for drug in drugs}\n\n\nloo = LeaveOneOut()\nloo.get_n_splits(abdata[\"T\"][abdata[\"drug1name\"] == \"WT\"])\n\n7\n\n\n\ninitial_flex\n\n{'AMP': [20.0, 46.5, 0.7, 0.7, 0.2, 0.005],\n 'CLI': [20.0, 46.5, 0.7, 0.7, 0.2, 0.005],\n 'CPR': [20.0, 46.5, 0.7, 0.7, 0.2, 0.005],\n 'ERY': [20.0, 46.5, 0.7, 0.7, 0.2, 0.005],\n 'FOX': [20.0, 46.5, 0.7, 0.7, 0.2, 0.005],\n 'GEN': [20.0, 46.5, 0.7, 0.7, 0.2, 0.005],\n 'LVX': [20.0, 46.5, 0.7, 0.7, 0.2, 0.005],\n 'NTR': [20.0, 46.5, 0.7, 0.7, 0.2, 0.005],\n 'STR': [20.0, 46.5, 0.7, 0.7, 0.2, 0.005],\n 'TET': [20.0, 46.5, 0.7, 0.7, 0.2, 0.005],\n 'TMP': [20.0, 46.5, 0.7, 0.7, 0.2, 0.005],\n 'TOB': [20.0, 46.5, 0.7, 0.7, 0.2, 0.005],\n 'WT': [20.0, 46.5, 0.7, 0.7, 0.2, 0.005]}\n\n\n\nT = np.arange(10, 50, 0.001)\nplt.figure(figsize=(15, 6))\n\n\nfor i, drug in enumerate(drugs):\n    subset = abdata[abdata[\"drug1name\"] == drug]\n    \n    plt.subplot(2, 7, i+1)\n    # Plot datapoints.\n    Tdata = subset[\"T\"]\n    rdata = subset[\"OD\"]\n\n    plt.plot(Tdata, rdata, '^')\n    \n    # Plot initial parameters curves by Briere.\n    par = initial_b1[drug]    \n    plt.plot(T, briere1(T, *par[:-1]), color=\"firebrick\")\n    \n    par = initial_b2[drug]\n    plt.plot(T, briere2(T, *par[:-1]), color=\"orange\")\n    \n    par = initial_flex[drug]\n    plt.plot(T, flexTPC(T, *par[:-1]), color=\"darkgreen\")\n    \n\n    plt.ylim(-0.025, 0.9)\n    plt.xlabel(\"Temperature [C]\")\n    plt.ylabel(\"OD\", fontsize=10)\n    plt.title(drug)\nplt.tight_layout()\n\n\n\n\n\n\n\n\n\n# LOOCV\n\nparams = {\"flexTPC\":{}, \"b1\":{}, \"b2\":{}}\nmodels = [\"b1\", \"b2\", \"flexTPC\"]\nloocv_nll = {model:{drug:[] for drug in drugs } for model in models}\n\nmethod = \"Nelder-Mead\"\nfor i, drug in enumerate(drugs):\n    subset = abdata[abdata[\"drug1name\"] == drug]\n    Tdata = np.array(subset[\"T\"])\n    rdata = np.array(subset[\"OD\"])\n    \n    print(drug)\n    print(\"numsplits:\", loo.get_n_splits(Tdata))\n    \n    for train, test in loo.split(Tdata):\n        T_train, r_train = Tdata[train], rdata[train]\n        T_test, r_test = Tdata[test], rdata[test]\n    \n\n        params[\"b1\"][drug] = minimize(nloglikab, initial_b1[drug],\n                           bounds=[(0.0, 20.0), \n                                    (30.0, 60.0), \n                                    (0.0, 10.0),  \n                                    (0, 0.01)],\n                      args=(Tdata, rdata, briere1), options={\"maxiter\":100000}, method=method)\n        θ = params[\"b1\"][drug][\"x\"]\n        loocv_nll[\"b1\"][drug].append(nloglikab(θ, T_test, r_test, model=briere1))\n\n        params[\"b2\"][drug] = minimize(nloglikab, initial_b2[drug],\n                            bounds=[(0.0, 20.0), \n                                    (30.0, 60.0), \n                                    (0.0, 10.0),\n                                    (1.0, 20.0),\n                                    (0, 0.01)],\n                      args=(Tdata, rdata, briere2), options={\"maxiter\":100000}, method=method)\n        θ = params[\"b2\"][drug][\"x\"]\n        loocv_nll[\"b2\"][drug].append(nloglikab(θ, T_test, r_test, model=briere2))\n\n        \n        params[\"flexTPC\"][drug] = minimize(nloglikab, initial_flex[drug], #Check nloglikab vs nloglok\n                            bounds=[(0.0, 20.0), \n                                    (30.0, 60.0), \n                                    (0.0, 1.0), \n                                    (0.1, 0.95), \n                                    (0.0, 2.0), \n                                    (0, 0.01)],\n                      args=(Tdata, rdata), options={\"maxiter\":100000}, method=method)\n        θ = params[\"flexTPC\"][drug][\"x\"]\n        loocv_nll[\"flexTPC\"][drug].append(nloglikab(θ, T_test, r_test, model=flexTPC))\n\nAMP\nnumsplits: 7\nCLI\nnumsplits: 7\nCPR\nnumsplits: 7\nERY\nnumsplits: 7\nFOX\nnumsplits: 7\nGEN\nnumsplits: 7\nLVX\nnumsplits: 7\nNTR\nnumsplits: 7\nSTR\nnumsplits: 7\nTET\nnumsplits: 7\nTMP\nnumsplits: 7\n\n\n/var/folders/g8/wjqhnz1n01d5l4pdv8cnykw40000gp/T/ipykernel_14925/1310441239.py:4: RuntimeWarning: divide by zero encountered in log\n  return 0.5 * (len(rdata) * np.log(2*np.pi*σ2) + np.sum((rdata\n/var/folders/g8/wjqhnz1n01d5l4pdv8cnykw40000gp/T/ipykernel_14925/1310441239.py:4: RuntimeWarning: divide by zero encountered in divide\n  return 0.5 * (len(rdata) * np.log(2*np.pi*σ2) + np.sum((rdata\n/var/folders/g8/wjqhnz1n01d5l4pdv8cnykw40000gp/T/ipykernel_14925/1310441239.py:4: RuntimeWarning: invalid value encountered in scalar add\n  return 0.5 * (len(rdata) * np.log(2*np.pi*σ2) + np.sum((rdata\n\n\nTOB\nnumsplits: 7\nWT\nnumsplits: 7\n\n\n\nparams = {\"flexTPC\":{}, \"b1\":{}, \"b2\":{}}\nmodels = [\"b1\", \"b2\", \"flexTPC\"]\nmethod = \"Nelder-Mead\"\nfor i, drug in enumerate(drugs):\n    subset = abdata[abdata[\"drug1name\"] == drug]\n    Tdata = np.array(subset[\"T\"])\n    rdata = np.array(subset[\"OD\"])    \n\n    params[\"b1\"][drug] = minimize(nloglikab, initial_b1[drug],\n                           bounds=[(0.0, 20.0), \n                                    (30.0, 60.0), \n                                    (0.0, 10.0),  \n                                    (0, 0.01)],\n                      args=(Tdata, rdata, briere1), options={\"maxiter\":100000}, method=method)\n    \n    params[\"b2\"][drug] = minimize(nloglikab, initial_b2[drug],\n                            bounds=[(0.0, 20.0), \n                                    (30.0, 60.0), \n                                    (0.0, 10.0),\n                                    (1.0, 20.0),\n                                    (0, 0.01)],\n                      args=(Tdata, rdata, briere2), options={\"maxiter\":100000}, method=method)\n    params[\"flexTPC\"][drug] = minimize(nloglikab, initial_flex[drug], #nloglikab vs nloglok\n                            bounds=[(0.0, 20.0), \n                                    (30.0, 60.0), \n                                    (0.0, 1.0), \n                                    (0.1, 0.95), \n                                    (0.0, 2.0), \n                                    (0, 0.01)],\n                      args=(Tdata, rdata), options={\"maxiter\":100000}, method=method)\n    \n\n/var/folders/g8/wjqhnz1n01d5l4pdv8cnykw40000gp/T/ipykernel_14925/1310441239.py:4: RuntimeWarning: divide by zero encountered in log\n  return 0.5 * (len(rdata) * np.log(2*np.pi*σ2) + np.sum((rdata\n/var/folders/g8/wjqhnz1n01d5l4pdv8cnykw40000gp/T/ipykernel_14925/1310441239.py:4: RuntimeWarning: divide by zero encountered in divide\n  return 0.5 * (len(rdata) * np.log(2*np.pi*σ2) + np.sum((rdata\n/var/folders/g8/wjqhnz1n01d5l4pdv8cnykw40000gp/T/ipykernel_14925/1310441239.py:4: RuntimeWarning: invalid value encountered in scalar add\n  return 0.5 * (len(rdata) * np.log(2*np.pi*σ2) + np.sum((rdata\n\n\n\nT = np.arange(10, 50, 0.001)\n\nfig, axarr = plt.subplots(3, 5, figsize=(6.81102, 4), dpi=300, sharex=True, sharey=True)\n\nplt.rcParams.update({'font.size': 8})\n\nfor i, drug in enumerate(drugs):\n    ax = axarr[i // 5, i % 5]\n    subset = abdata[abdata[\"drug1name\"] == drug]\n\n    ax.set_xticks([10, 20, 30, 40, 50])\n    ax.set_yticks([0, 0.5, 1])\n\n\n    #plt.subplot(3, 5, i+1)\n    # Plot datapoints.\n    Tdata = subset[\"T\"]\n    rdata = subset[\"OD\"]\n\n    ax.plot(Tdata, rdata, '^', markersize=3)\n    \n    # Plot fitted curves by Briere.\n    #par = initial_b1[drug]\n    par = params[\"b1\"][drug][\"x\"]\n    \n    ax.plot(T, briere1(T, *par[:-1]), color=\"firebrick\", linewidth=1, alpha=0.8)\n    \n    #par = initial_b2[drug]\n    par = params[\"b2\"][drug][\"x\"]\n    ax.plot(T, briere2(T, *par[:-1]), color=\"orange\", linewidth=1, alpha=0.8)\n    \n             \n    par = params[\"flexTPC\"][drug][\"x\"]\n    #par = initial_mb[drug]\n    ax.plot(T, flexTPC(T, *par[:-1]), color=\"darkgreen\", linewidth=1, alpha=0.8)\n    \n\n    ax.set_ylim(-0.025, 1.0)\n\n    if drug != 'WT':\n        ax.set_title(drug, fontsize=10)\n    else:\n        ax.set_title('no drug', fontsize=10)\n    if drug in (\"TMP\", \"TOB\", \"WT\"):\n        ax.set_xlabel(\"Temperature [°C]\", fontsize=8)\n    if drug in (\"AMP\", \"GEN\", \"TMP\"):\n        ax.set_ylabel(\"OD\", fontsize=10)\n        \naxarr[-1, -1].axis(\"off\")\naxarr[-1, -2].axis(\"off\")\n\n\n#ERY\n#rect = plt.Rectangle(\n#        # (lower-left corner), width, height\n#        (0.63, 0.69), 0.18, 0.29, fill=False, color=\"k\", lw=1.5, \n#        zorder=1000, transform=fig.transFigure, figure=fig\n#    )\n\n#GEN\n#rect2 = plt.Rectangle(\n#        # (lower-left corner), width, height\n#        (0.04, 0.4), 0.22, 0.29, fill=False, color=\"k\", lw=1.5, \n#        zorder=1000, transform=fig.transFigure, figure=fig\n#    )\n\n#fig.patches.extend([rect, rect2])\nplt.tight_layout()\n\nplt.savefig(\"abcoli.svg\")\nplt.savefig(\"abcoli.pdf\")\nplt.savefig(\"abcoli.png\")\n\n\n\n\n\n\n\n\n\nn_params = {'b1':4, 'b2':5, 'flexTPC':6} # Includes standard deviation.\nparam_matrix = {model:np.zeros((13, n_params[model])) for model in models}\n\nfor model in models:\n    for i, drug in enumerate(drugs):\n        param_matrix[model][i, ] = params[model][drug][\"x\"]\n\ncolnames = {'b1':['Tmin', 'Tmax', 'c', 'sigma2'],\n            'b2':['Tmin', 'Tmax', 'c', 'm', 'sigma2'],\n            'flexTPC':['Tmin', 'Tmax', 'rmax', 'alpha', 'beta', 'sigma2']}\n\nparam_df = {model:pd.DataFrame(param_matrix[model], columns=colnames[model]) for model in models}\nfor model in models:\n    param_df[model]['drug'] = drugs\n    param_df[model] = param_df[model][['drug'] + colnames[model]]\n    param_df[model].to_csv(f'abcoli_params_{model}.csv', index=False)\n\n\nparam_df['flexTPC']\n\n\n\n\n\n\n\n\ndrug\nTmin\nTmax\nrmax\nalpha\nbeta\nsigma2\n\n\n\n\n0\nAMP\n20.0\n44.000003\n0.756763\n0.642037\n0.437539\n0.000913\n\n\n1\nCLI\n20.0\n44.000031\n0.661223\n0.765370\n0.387482\n0.002158\n\n\n2\nCPR\n20.0\n44.195263\n0.845881\n0.795025\n0.243240\n0.001969\n\n\n3\nERY\n20.0\n60.000000\n0.514508\n0.465700\n0.097313\n0.005200\n\n\n4\nFOX\n20.0\n44.000001\n0.558624\n0.880069\n0.352395\n0.000517\n\n\n5\nGEN\n20.0\n44.000000\n0.358805\n0.574757\n0.617911\n0.001757\n\n\n6\nLVX\n20.0\n44.026381\n0.823561\n0.788428\n0.362861\n0.001786\n\n\n7\nNTR\n20.0\n44.000001\n0.768543\n0.769126\n0.313968\n0.000812\n\n\n8\nSTR\n20.0\n44.000015\n0.425230\n0.604259\n0.500803\n0.001711\n\n\n9\nTET\n20.0\n44.001389\n0.712707\n0.872408\n0.331231\n0.001259\n\n\n10\nTMP\n20.0\n43.999978\n0.680682\n0.781958\n0.377130\n0.000328\n\n\n11\nTOB\n20.0\n44.000006\n0.476745\n0.624377\n0.473043\n0.000884\n\n\n12\nWT\n20.0\n44.003304\n0.793973\n0.852714\n0.436919\n0.000283\n\n\n\n\n\n\n\n\nnll = np.zeros((len(drugs), len(models)))\naic = np.zeros((len(drugs), len(models)))\nbic = np.zeros((len(drugs), len(models)))\nloo_nll = np.zeros((len(drugs), len(models)))\n\np = [4, 5, 6] # Number of parameters.\nn = 7 # Number of datapoints.\n\nfor i, d in enumerate(drugs):\n    for j, m in enumerate(models): \n        nll[i, j] = params[m][d][\"fun\"]\n        aic[i, j] = AIC(nll[i, j], p[j])\n        bic[i, j] = BIC(nll[i, j], n, p[j])\n        loo_nll[i, j] = np.mean(loocv_nll[m][d])\n\n\ndrugs\n\n['AMP',\n 'CLI',\n 'CPR',\n 'ERY',\n 'FOX',\n 'GEN',\n 'LVX',\n 'NTR',\n 'STR',\n 'TET',\n 'TMP',\n 'TOB',\n 'WT']\n\n\n\nfor drug in drugs:\n    print(drug, np.round(params[\"flexTPC\"][drug][\"x\"], 3) )\n\nAMP [2.00e+01 4.40e+01 7.57e-01 6.42e-01 4.38e-01 1.00e-03]\nCLI [2.00e+01 4.40e+01 6.61e-01 7.65e-01 3.87e-01 2.00e-03]\nCPR [2.0000e+01 4.4195e+01 8.4600e-01 7.9500e-01 2.4300e-01 2.0000e-03]\nERY [2.00e+01 6.00e+01 5.15e-01 4.66e-01 9.70e-02 5.00e-03]\nFOX [2.00e+01 4.40e+01 5.59e-01 8.80e-01 3.52e-01 1.00e-03]\nGEN [2.00e+01 4.40e+01 3.59e-01 5.75e-01 6.18e-01 2.00e-03]\nLVX [2.0000e+01 4.4026e+01 8.2400e-01 7.8800e-01 3.6300e-01 2.0000e-03]\nNTR [2.00e+01 4.40e+01 7.69e-01 7.69e-01 3.14e-01 1.00e-03]\nSTR [2.00e+01 4.40e+01 4.25e-01 6.04e-01 5.01e-01 2.00e-03]\nTET [2.0000e+01 4.4001e+01 7.1300e-01 8.7200e-01 3.3100e-01 1.0000e-03]\nTMP [20.    44.     0.681  0.782  0.377  0.   ]\nTOB [2.00e+01 4.40e+01 4.77e-01 6.24e-01 4.73e-01 1.00e-03]\nWT [20.    44.003  0.794  0.853  0.437  0.   ]\n\n\n\ndfAIC = pd.DataFrame(np.round(aic, 2), columns=models, index=drugs)\ndfBIC = pd.DataFrame(np.round(bic, 2), columns=models, index=drugs)\ndfLOOCV = pd.DataFrame(np.round(loo_nll, 2), columns=models, index=drugs)\n\n\ndfAIC\n\n\n\n\n\n\n\n\nb1\nb2\nflexTPC\n\n\n\n\nAMP\n-5.56\n-8.64\n-17.12\n\n\nCLI\n-11.98\n-10.51\n-11.38\n\n\nCPR\n-2.92\n-7.16\n-11.75\n\n\nERY\n3.28\n0.25\n-4.95\n\n\nFOX\n-18.14\n-16.31\n-21.11\n\n\nGEN\n-3.16\n-3.96\n-11.56\n\n\nLVX\n-12.93\n-10.96\n-12.43\n\n\nNTR\n-16.03\n-16.47\n-17.42\n\n\nSTR\n-5.39\n-7.42\n-12.87\n\n\nTET\n-15.07\n-13.83\n-14.88\n\n\nTMP\n-18.63\n-16.74\n-24.29\n\n\nTOB\n-7.15\n-9.40\n-17.35\n\n\nWT\n-5.49\n-6.43\n-25.33\n\n\n\n\n\n\n\n\ndfBIC\n\n\n\n\n\n\n\n\nb1\nb2\nflexTPC\n\n\n\n\nAMP\n-5.78\n-8.91\n-17.45\n\n\nCLI\n-12.19\n-10.78\n-11.70\n\n\nCPR\n-3.14\n-7.43\n-12.07\n\n\nERY\n3.07\n-0.02\n-5.27\n\n\nFOX\n-18.35\n-16.58\n-21.43\n\n\nGEN\n-3.38\n-4.23\n-11.88\n\n\nLVX\n-13.15\n-11.23\n-12.75\n\n\nNTR\n-16.25\n-16.74\n-17.74\n\n\nSTR\n-5.61\n-7.69\n-13.19\n\n\nTET\n-15.28\n-14.10\n-15.20\n\n\nTMP\n-18.85\n-17.01\n-24.61\n\n\nTOB\n-7.37\n-9.67\n-17.68\n\n\nWT\n-5.70\n-6.70\n-25.65\n\n\n\n\n\n\n\n\ndfLOOCV\n\n\n\n\n\n\n\n\nb1\nb2\nflexTPC\n\n\n\n\nAMP\n-0.97\n-1.33\n-2.08\n\n\nCLI\n-1.43\n-1.47\n-1.67\n\n\nCPR\n-0.78\n-1.23\n-1.70\n\n\nERY\n-0.34\n-0.70\n-1.21\n\n\nFOX\n-1.87\n-1.88\n-2.36\n\n\nGEN\n-0.80\n-1.00\n-1.68\n\n\nLVX\n-1.50\n-1.50\n-1.74\n\n\nNTR\n-1.72\n-1.89\n-2.10\n\n\nSTR\n-0.96\n-1.24\n-1.78\n\n\nTET\n-1.65\n-1.70\n-1.92\n\n\nTMP\n-1.90\n-1.91\n-2.59\n\n\nTOB\n-1.08\n-1.39\n-2.10\n\n\nWT\n-0.96\n-1.17\n-2.67"
  },
  {
    "objectID": "model_comparison/Botrana.html",
    "href": "model_comparison/Botrana.html",
    "title": "Comparison of Briere and flexTPC models in insect development data",
    "section": "",
    "text": "import numpy as np\nimport pandas as pd\nimport random\nrandom.seed(42) # Set seed for reproducibility\n\nfrom matplotlib import pyplot as plt\n\nfrom scipy.optimize import minimize\nfrom sklearn.model_selection import LeaveOneOut\ndef briere1(T, Tmin=10.0, Tmax=50.0, c=1.0):\n    result = np.zeros(len(T))\n    cond = (Tmin &lt; T) & (T &lt; Tmax)\n    result[cond] = c * T[cond] * np.exp(np.log(T[cond] - Tmin) + 0.5 * np.log(Tmax - T[cond]))\n    return result\n\ndef briere2(T, Tmin=10.0, Tmax=50.0, c=1.0, b=2.0):\n    result = np.zeros(len(T))\n    cond = (Tmin &lt; T) & (T &lt; Tmax)\n    result[cond] = c * T[cond] * np.exp(np.log(T[cond] - Tmin) +  np.log(Tmax - T[cond]) / b)\n    return result\n\n# Fully biologically interpretable parametrization of flexTPC model\ndef flexTPC(T, Tmin=10.0, Tmax=50.0, rmax=1.0, α=0.8, β=0.2):\n    result = np.zeros(len(T))\n    cond = (Tmin &lt; T) & (T &lt; Tmax)\n    s = α * (1.0 - α) / β**2\n    result[cond] = rmax * np.exp(s * (α * (np.log(T[cond] - Tmin) - np.log(α)) +\n                                      (1 - α) * (np.log(Tmax - T[cond]) - np.log(1 - α) )\n                                       - np.log(Tmax - Tmin)))\n    return result\ndef nloglik(θ, Tdata, rdata, model=flexTPC):\n    params, σ2 = θ[:-1], θ[-1]\n    Tmin, Tmax = θ[:2]\n    outside = (Tdata &lt; Tmin) | (Tdata &gt; Tmax)\n    inside = ~outside\n    n = len(rdata[inside])\n    if np.any(rdata[outside] &gt; 0.0):\n        return np.inf\n    else:\n        return 0.5 * (n * np.log(2*np.pi*σ2) + np.sum((rdata[inside] - model(Tdata[inside], *params))**2 / σ2))\n    \ndef AIC(nll, p):\n    return 2 * nll + 2 * p \n\ndef BIC(nll, n, p):\n    return 2 * nll + p * np.log(n)"
  },
  {
    "objectID": "model_comparison/Botrana.html#l.-botrana-development-dataset",
    "href": "model_comparison/Botrana.html#l.-botrana-development-dataset",
    "title": "Comparison of Briere and flexTPC models in insect development data",
    "section": "L. botrana development dataset",
    "text": "L. botrana development dataset\nFirst, let’s compare the model performance in Briere’s original dataset.\n\nbotrana = pd.read_csv(\"briere_data_L_botrana.csv\")\nstages = [\"eggs\", \"i1\", \"i2\", \"i3\", \"i4\", \"i5\", \"pupae\"]\n\n\nbotrana\n\n\n\n\n\n\n\n\nT\nn_eggs\neggs\nn_i1\ni1\nn_i2\ni2\nn_i3\ni3\nn_i4\ni4\nn_i5\ni5\nn_pupae\npupae\n\n\n\n\n0\n8\n0\ninf\n0\ninf\n0\ninf\n0\ninf\n0\ninf\n0\ninf\n0\ninf\n\n\n1\n10\n0\ninf\n28\n25.9\n14\n23.2\n0\ninf\n0\ninf\n0\ninf\n0\ninf\n\n\n2\n12\n77\n26.8\n48\n23.4\n23\n16.1\n15\n12.7\n12\n15.7\n11\n25.5\n0\ninf\n\n\n3\n14\n104\n19.4\n45\n15.1\n36\n10.6\n32\n9.8\n31\n10.6\n31\n17.9\n6\n48.0\n\n\n4\n16\n369\n15.6\n47\n13.2\n41\n8.9\n36\n8.3\n35\n10.0\n33\n13.5\n25\n35.5\n\n\n5\n18\n600\n11.0\n44\n11.7\n41\n7.1\n40\n5.6\n38\n7.0\n36\n13.3\n41\n23.2\n\n\n6\n20\n674\n8.2\n44\n5.9\n44\n4.8\n40\n4.7\n37\n5.1\n35\n7.6\n41\n15.1\n\n\n7\n22\n837\n7.0\n50\n4.2\n48\n3.8\n46\n4.0\n42\n4.9\n41\n7.1\n45\n12.9\n\n\n8\n24\n662\n5.3\n49\n3.9\n45\n3.1\n44\n3.8\n44\n3.7\n40\n6.5\n50\n10.2\n\n\n9\n26\n696\n5.1\n50\n3.7\n45\n3.0\n45\n3.2\n44\n3.6\n40\n6.2\n50\n8.6\n\n\n10\n28\n559\n5.0\n50\n3.6\n43\n2.9\n40\n3.0\n40\n3.6\n38\n6.0\n46\n7.9\n\n\n11\n30\n210\n4.9\n46\n3.3\n46\n2.9\n45\n2.9\n44\n2.9\n40\n5.8\n41\n7.8\n\n\n12\n32\n0\ninf\n47\n4.5\n43\n3.4\n42\n3.4\n38\n3.9\n26\n6.9\n45\n7.7\n\n\n13\n34\n0\ninf\n30\n6.7\n27\n6.4\n0\ninf\n0\ninf\n0\ninf\n19\ninf\n\n\n\n\n\n\n\n\n# Find initial estimates of minimum and maximum temperatures from data.\nTlims = {}\nfor i, stage in enumerate(stages):\n    T = botrana[\"T\"][botrana[stage] &lt; np.inf]\n    Tlims[stage] = (min(T) - 0.5, max(T) + 0.5)\n    print(stage, Tlims[stage])\n\n# Set initial estimates of maximum trait value.\ninit_rmax = {'eggs': 0.2,\n             'i1':0.2,\n             'i2':0.2,\n             'i3':0.2,\n             'i4':0.2,\n             'i5':0.2,\n            'pupae':0.2}\n\n# Set initial parameter values for all models.\ninitial_flex = {stage:[7.0, 36.0, init_rmax[stage], 0.8, 0.1, 0.015] for stage in stages}\ninitial_b1 = {stage:[7.0, 36.0, 7e-5, 0.015] for stage in stages}\ninitial_b2 = {stage:[7.0, 36.0, 7e-5, 2.0, 0.015] for stage in stages}\n\neggs (11.5, 30.5)\ni1 (9.5, 34.5)\ni2 (9.5, 34.5)\ni3 (11.5, 32.5)\ni4 (11.5, 32.5)\ni5 (11.5, 32.5)\npupae (13.5, 32.5)\n\n\n\nloo = LeaveOneOut()\nloo.get_n_splits(botrana[\"T\"])\n\n14\n\n\n\n# Calculate leave-one-out cross validated log likelihood.\nparams = {\"flexTPC\":{}, \"b1\":{}, \"b2\":{}}\nmodels = [\"b1\", \"b2\", \"flexTPC\"]\nmethod = \"Nelder-Mead\"\nloocv_nll = {model:{stage:[] for stage in stages } for model in models}\n\nfor i, y in enumerate(stages):\n    Tdata = np.array(botrana[\"T\"])\n    rdata = 1.0 / np.array(botrana[y])\n    \n    for train, test in loo.split(Tdata):\n        T_train, r_train = Tdata[train], rdata[train]\n        T_test, r_test = Tdata[test], rdata[test]\n        \n        params[\"b1\"][y] = minimize(nloglik, initial_b1[y],\n                            bounds=[(0.0, 20.0), \n                                    (20.0, 60.0), \n                                    (0.0, 1.0),  \n                                    (0, 1.0)],\n                      args=(T_train, r_train, briere1), options={\"maxiter\":100000}, method=method)\n        θ = params[\"b1\"][y][\"x\"]\n        loocv_nll[\"b1\"][y].append(nloglik(θ, T_test, r_test, model=briere1))\n        \n        params[\"b2\"][y] = minimize(nloglik, initial_b2[y],\n                            bounds=[(0.0, 20.0), \n                                    (20.0, 60.0), \n                                    (0.0, 1.0), \n                                    (1.0, 20.0),\n                                    (0, 1.0)],\n                      args=(Tdata, rdata, briere2), options={\"maxiter\":100000}, method=method)\n        θ = params[\"b2\"][y][\"x\"]\n        loocv_nll[\"b2\"][y].append(nloglik(θ, T_test, r_test, model=briere2))\n        \n        params[\"flexTPC\"][y] = minimize(nloglik, initial_flex[y],\n                                bounds=[(0.0, 20.0), \n                                        (20.0, 60.0), \n                                        (0.0, 1.0), \n                                        (0.0, 1.0), \n                                        (0.0, np.inf), \n                                        (0, 1.0)],\n                          args=(Tdata, rdata, flexTPC), options={\"maxiter\":100000}, method=method)\n        θ = params[\"flexTPC\"][y][\"x\"]\n        loocv_nll[\"flexTPC\"][y].append(nloglik(θ, T_test, r_test, model=flexTPC))\n\n/var/folders/g8/wjqhnz1n01d5l4pdv8cnykw40000gp/T/ipykernel_8663/2868019315.py:10: RuntimeWarning: divide by zero encountered in log\n  return 0.5 * (n * np.log(2*np.pi*σ2) + np.sum((rdata[inside] - model(Tdata[inside], *params))**2 / σ2))\n/var/folders/g8/wjqhnz1n01d5l4pdv8cnykw40000gp/T/ipykernel_8663/2868019315.py:10: RuntimeWarning: divide by zero encountered in divide\n  return 0.5 * (n * np.log(2*np.pi*σ2) + np.sum((rdata[inside] - model(Tdata[inside], *params))**2 / σ2))\n/var/folders/g8/wjqhnz1n01d5l4pdv8cnykw40000gp/T/ipykernel_8663/2868019315.py:10: RuntimeWarning: invalid value encountered in scalar add\n  return 0.5 * (n * np.log(2*np.pi*σ2) + np.sum((rdata[inside] - model(Tdata[inside], *params))**2 / σ2))\n\n\n\n# Fit to entire dataset.\n\nparams = {\"flexTPC\":{}, \"b1\":{}, \"b2\":{}}\nmodels = [\"b1\", \"b2\", \"flexTPC\"]\nmethod = \"Nelder-Mead\"\n\nfor i, y in enumerate(stages):\n    Tdata = np.array(botrana[\"T\"])\n    rdata = 1.0 / np.array(botrana[y])\n    \n    \n    params[\"b1\"][y] = minimize(nloglik, initial_b1[y],\n                        bounds=[(0.0, 20.0), \n                                (20.0, 60.0), \n                                (0.0, 1.0),  \n                                (0, 1.0)],\n                  args=(Tdata, rdata, briere1), options={\"maxiter\":100000}, method=method)\n    params[\"b2\"][y] = minimize(nloglik, initial_b2[y],\n                        bounds=[(0.0, 20.0), \n                                (20.0, 60.0), \n                                (0.0, 1.0), \n                                (1.0, 20.0),\n                                (0, 1.0)],\n                  args=(Tdata, rdata, briere2), options={\"maxiter\":100000}, method=method)\n    params[\"flexTPC\"][y] = minimize(nloglik, initial_flex[y],\n                        bounds=[(0.0, 20.0), \n                                (20.0, 60.0), \n                                (0.0, 1.0), \n                                (0.0, 1.0), \n                                (0.0, np.inf), \n                                (0, 1.0)],\n                  args=(Tdata, rdata, flexTPC), options={\"maxiter\":100000}, method=method)\n\n/var/folders/g8/wjqhnz1n01d5l4pdv8cnykw40000gp/T/ipykernel_8663/2868019315.py:10: RuntimeWarning: divide by zero encountered in log\n  return 0.5 * (n * np.log(2*np.pi*σ2) + np.sum((rdata[inside] - model(Tdata[inside], *params))**2 / σ2))\n/var/folders/g8/wjqhnz1n01d5l4pdv8cnykw40000gp/T/ipykernel_8663/2868019315.py:10: RuntimeWarning: divide by zero encountered in divide\n  return 0.5 * (n * np.log(2*np.pi*σ2) + np.sum((rdata[inside] - model(Tdata[inside], *params))**2 / σ2))\n/var/folders/g8/wjqhnz1n01d5l4pdv8cnykw40000gp/T/ipykernel_8663/2868019315.py:10: RuntimeWarning: invalid value encountered in scalar add\n  return 0.5 * (n * np.log(2*np.pi*σ2) + np.sum((rdata[inside] - model(Tdata[inside], *params))**2 / σ2))\n\n\n\nT = np.arange(5, 36.5, 0.001)\n#plt.figure(figsize=(5, 6.5), dpi=300)\n#plt.figure(figsize=(4.33, 6.5), dpi=300)\nalpha=0.8\n\nfig, axarr = plt.subplots(2, 4, figsize=(6.5, 3), dpi=300, sharex=True, sharey=True)\n\nfor i, y in enumerate(stages):\n    ax = axarr[i // 4, i % 4]\n    Tdata = np.array(botrana[\"T\"])\n    rdata = 1.0 / np.array(botrana[y])\n\n    ax.plot(Tdata, rdata, '^')\n    \n    # Plot fitted curves by models.\n    par = params[\"b1\"][y][\"x\"]\n    ax.plot(T, briere1(T, *par[:-1]), color=\"firebrick\", alpha=alpha)\n             \n    par = params[\"b2\"][y][\"x\"]\n    ax.plot(T, briere2(T, *par[:-1]), color=\"orange\", alpha=alpha)\n    \n    par = params[\"flexTPC\"][y][\"x\"]\n    ax.plot(T, flexTPC(T, *par[:-1]), color=\"darkgreen\", alpha=alpha)\n    ax.set_ylim(-0.025, 0.4)\n    if y in (\"eggs\", \"i4\"):\n        ax.set_ylabel(\"Dev. rate [1 / day]\", fontsize=9)\n    if y in (\"i4\", \"i5\", \"pupae\"):\n        ax.set_xlabel(\"Temperature [°C]\", fontsize=9)\n    ax.set_title(y, fontsize=10)\naxarr[-1, -1].axis(\"off\")\nplt.tight_layout()\nplt.savefig(\"botrana.svg\")\nplt.savefig(\"botrana.tiff\")\nplt.savefig(\"botrana.png\")\nplt.savefig(\"botrana.pdf\")\n\n\n\n\n\n\n\n\n\nn_params = {'b1':4, 'b2':5, 'flexTPC':6} # Includes standard deviation.\nparam_matrix = {model:np.zeros((7, n_params[model])) for model in models}\n\nfor model in models:\n    for i, stage in enumerate(stages):\n        param_matrix[model][i, ] = params[model][stage][\"x\"]\n\ncolnames = {'b1':['Tmin', 'Tmax', 'c', 'sigma2'],\n            'b2':['Tmin', 'Tmax', 'c', 'm', 'sigma2'],\n            'flexTPC':['Tmin', 'Tmax', 'rmax', 'alpha', 'beta', 'sigma2']}\n\nparam_df = {model:pd.DataFrame(param_matrix[model], columns=colnames[model]) for model in models}\nfor model in models:\n    param_df[model]['stage'] = stages\n    param_df[model] = param_df[model][['stage'] + colnames[model]]\n    param_df[model].to_csv(f'botrana_params_{model}.csv', index=False)\n\n\nnp.round(param_df['flexTPC'], 2)\n\n\n\n\n\n\n\n\nstage\nTmin\nTmax\nrmax\nalpha\nbeta\nsigma2\n\n\n\n\n0\neggs\n4.03\n34.00\n0.21\n0.74\n0.19\n0.0\n\n\n1\ni1\n0.00\n36.69\n0.29\n0.77\n0.18\n0.0\n\n\n2\ni2\n0.00\n35.10\n0.36\n0.81\n0.19\n0.0\n\n\n3\ni3\n4.87\n34.00\n0.35\n0.87\n0.23\n0.0\n\n\n4\ni4\n1.62\n34.00\n0.30\n0.84\n0.21\n0.0\n\n\n5\ni5\n0.00\n34.00\n0.18\n0.83\n0.20\n0.0\n\n\n6\npupae\n3.48\n34.00\n0.14\n0.87\n0.19\n0.0\n\n\n\n\n\n\n\n\nnp.round(param_matrix['flexTPC'], 3)\n\narray([[4.0260e+00, 3.4000e+01, 2.0600e-01, 7.3500e-01, 1.8500e-01,\n        1.0000e-03],\n       [0.0000e+00, 3.6692e+01, 2.9400e-01, 7.6500e-01, 1.8100e-01,\n        0.0000e+00],\n       [3.0000e-03, 3.5100e+01, 3.5600e-01, 8.0900e-01, 1.9400e-01,\n        0.0000e+00],\n       [4.8700e+00, 3.4000e+01, 3.4500e-01, 8.7200e-01, 2.3500e-01,\n        0.0000e+00],\n       [1.6180e+00, 3.4000e+01, 3.0000e-01, 8.4200e-01, 2.1200e-01,\n        0.0000e+00],\n       [0.0000e+00, 3.4000e+01, 1.7700e-01, 8.3300e-01, 2.0500e-01,\n        0.0000e+00],\n       [3.4760e+00, 3.4000e+01, 1.3500e-01, 8.6700e-01, 1.8600e-01,\n        0.0000e+00]])\n\n\n\nstage\n\n'pupae'\n\n\n\nnll = np.zeros((len(stages), len(models)))\nloo_nll = np.zeros((len(stages), len(models)))\naic = np.zeros((len(stages), len(models)))\nbic = np.zeros((len(stages), len(models)))\n\n\np = [4, 5, 6] # Number of parameters (including variance parameter).\nn = 14 # Number of datapoints.\n\nfor i, s in enumerate(stages):\n    for j, m in enumerate(models): \n        nll[i, j] = params[m][s][\"fun\"]\n        loo_nll[i, j] = np.mean(loocv_nll[m][s])\n        aic[i, j] = AIC(nll[i, j], p[j])\n        bic[i, j] = BIC(nll[i, j], n, p[j])\n\n\ndfAIC = pd.DataFrame(np.round(aic, 2), columns=models, index=stages)\ndfBIC = pd.DataFrame(np.round(bic, 2), columns=models, index=stages)\ndfLOOCV = pd.DataFrame(np.round(loo_nll, 2), columns=models, index=stages)\n\n\ndfAIC\n\n\n\n\n\n\n\n\nb1\nb2\nflexTPC\n\n\n\n\neggs\n-55.89\n-40.25\n-49.61\n\n\ni1\n-59.19\n-54.92\n-62.00\n\n\ni2\n-71.53\n-70.63\n-74.22\n\n\ni3\n-41.38\n-33.46\n-60.92\n\n\ni4\n-59.92\n-63.21\n-58.29\n\n\ni5\n-57.53\n-75.16\n-75.49\n\n\npupae\n-68.13\n-72.66\n-98.48\n\n\n\n\n\n\n\n\ndfBIC\n\n\n\n\n\n\n\n\nb1\nb2\nflexTPC\n\n\n\n\neggs\n-53.33\n-37.06\n-45.78\n\n\ni1\n-56.64\n-51.73\n-58.17\n\n\ni2\n-68.98\n-67.44\n-70.39\n\n\ni3\n-38.82\n-30.26\n-57.09\n\n\ni4\n-57.36\n-60.02\n-54.45\n\n\ni5\n-54.97\n-71.97\n-71.66\n\n\npupae\n-65.58\n-69.46\n-94.65\n\n\n\n\n\n\n\n\ndfLOOCV\n\n\n\n\n\n\n\n\nb1\nb2\nflexTPC\n\n\n\n\neggs\n2.00\n-1.79\n-2.20\n\n\ni1\n-1.46\n-2.32\n-2.64\n\n\ni2\n-2.24\n-2.88\n-3.08\n\n\ni3\n7.16\n-1.55\n-2.60\n\n\ni4\n2.14\n-2.61\n-2.51\n\n\ni5\n-0.48\n-3.04\n-3.12\n\n\npupae\n10.80\n-2.95\n-3.95\n\n\n\n\n\n\n\n\nprint(dfLOOCV.to_latex())\n\n\nprint(dfAIC.to_latex())\n\n\nprint(dfBIC.to_latex())"
  },
  {
    "objectID": "fit_examples.html",
    "href": "fit_examples.html",
    "title": "FlexTPC tutorial",
    "section": "",
    "text": "FlexTPC is a model for thermal performance curves that is both flexible and interpretable. In this tutorial, we provide example R code to fit flexTPC to data with various different methods.\nFirst, we provide code that implements he flexTPC functional form. There are two different parametrizations of flexTPC that can be useful in different circumstances.\n# FlexTPC model for thermal performance curves.\n# (parametrized with alpha/beta)\nflexTPC &lt;- function(T, Tmin, Tmax, rmax, alpha, beta) {\n  s &lt;- alpha * (1 - alpha) / beta^2\n  result &lt;- rep(0, length(T))\n  Tidx = (T &gt; Tmin) & (T &lt; Tmax)\n  result[Tidx] &lt;- rmax * exp(s * (alpha * log( (T[Tidx] - Tmin) / alpha) \n                  + (1 - alpha) * log( (Tmax - T[Tidx]) / (1 - alpha)) \n                  - log(Tmax - Tmin)) ) \n  return(result)\n}\n  \n# FlexTPC model for thermal performance curves.\n# (parametrized with Topt/B)\nflexTPC2 &lt;- function(T, Tmin, Tmax, rmax, Topt, B) {\n  alpha &lt;- (Topt - Tmin) / (Tmax - Tmin)\n  beta &lt;- B / (Tmax - Tmin)\n  return(flexTPC(T, Tmin, Tmax, rmax, alpha, beta))\n}\nLet’s show how to plot a TPC. You can choose to parametrize flexTPC with the nondimensional or dimensional version of the optimal temperature and the thermal breadth near the peak.\ntemp &lt;- seq(5, 38, 0.1)\n\nplot(temp, flexTPC(temp, Tmin=10, Tmax=35, rmax=1.0, alpha=0.8, beta=0.2), type='l',\n     xlab='temperature [°C]', ylab='trait performance')\n\n# Intentionally picking a Topt that is a little lower than the previous\n# curve so they are not plotted on top of each other.\nlines(temp, flexTPC2(temp, Tmin=10, Tmax=35, rmax=1.0, Topt=29.0, B=5.0),\n     xlab='temperature [°C]', ylab='trait performance', col='red')\nWe now show how to fit flexTPC to an example dataset."
  },
  {
    "objectID": "fit_examples.html#least-squares-estimation",
    "href": "fit_examples.html#least-squares-estimation",
    "title": "FlexTPC tutorial",
    "section": "Least squares estimation",
    "text": "Least squares estimation\nA simple approach to estimate TPCs is to perform nonlinear least squares estimation. This finds the curve that minimizes the squared difference between the TPC and the data points."
  },
  {
    "objectID": "fit_examples.html#maximum-likelihood-estimation",
    "href": "fit_examples.html#maximum-likelihood-estimation",
    "title": "FlexTPC tutorial",
    "section": "Maximum likelihood estimation",
    "text": "Maximum likelihood estimation\nWhen fitting a thermal performance curve model to data it is helpful to think about the model being comprised of two parts:\n\nA functional form \\(r(T)\\) for the thermal performance curve (e.g. flexTPC, the Briere model, etc.) that describes the temperature dependence of a biological trait.\nA model of the errors, which describes a plausible mechanism of generating the observed datapoints from the model around the mean given by \\(r(T)\\).\n\nLeast squares estimation is equivalent to assuming the model residuals are normally distributed with a constant variance."
  },
  {
    "objectID": "model_comparison/Gounot.html",
    "href": "model_comparison/Gounot.html",
    "title": "Gounot dataset of bacteria from glaciers",
    "section": "",
    "text": "import numpy as np\nimport pandas as pd\nimport random\n\nrandom.seed(42)\n\nfrom matplotlib import pyplot as plt\n\nfrom scipy.optimize import minimize\nfrom sklearn.model_selection import LeaveOneOut\ndef briere1(T, Tmin=10.0, Tmax=50.0, c=1.0):\n    result = np.zeros(len(T))\n    cond = (Tmin &lt; T) & (T &lt; Tmax)\n    result[cond] = c * T[cond] * np.exp(np.log(T[cond] - Tmin) + 0.5 * np.log(Tmax - T[cond]))\n    return result\n\ndef briere2(T, Tmin=10.0, Tmax=50.0, c=1.0, b=2.0):\n    result = np.zeros(len(T))\n    cond = (Tmin &lt; T) & (T &lt; Tmax)\n    result[cond] = c * T[cond] * np.exp(np.log(T[cond] - Tmin) +  np.log(Tmax - T[cond]) / b)\n    return result\n\n# Fully biologically interpretable parametrization of flexTPC model\ndef flexTPC(T, Tmin=10.0, Tmax=50.0, rmax=1.0, α=0.8, β=0.2):\n    result = np.zeros(len(T))\n    cond = (Tmin &lt; T) & (T &lt; Tmax)\n    s = α * (1.0 - α) / β**2\n    result[cond] = rmax * np.exp(s * (α * (np.log(T[cond] - Tmin) - np.log(α)) +\n                                      (1 - α) * (np.log(Tmax - T[cond]) - np.log(1 - α) )\n                                       - np.log(Tmax - Tmin)))\n    return result\nglacierbac = pd.read_csv(\"glacierbac.csv\")\nglacierbac\n\n\n\n\n\n\n\n\nUnnamed: 0\nspecies\nstrain\nX\nY\npsychro\nT\nr\n\n\n\n\n0\n0\nArthrobacter glacialis\n137\n3.457467\n3.761369\nTrue\n16.0\n0.043007\n\n\n1\n1\nArthrobacter glacialis\n137\n3.482460\n3.985740\nTrue\n14.0\n0.053825\n\n\n2\n2\nArthrobacter glacialis\n137\n3.501018\n3.973215\nTrue\n12.0\n0.053155\n\n\n3\n3\nArthrobacter glacialis\n137\n3.527881\n3.858413\nTrue\n10.0\n0.047390\n\n\n4\n4\nArthrobacter glacialis\n137\n3.565603\n3.596571\nTrue\n7.0\n0.036473\n\n\n5\n5\nArthrobacter glacialis\n137\n3.603963\n3.328340\nTrue\n4.0\n0.027892\n\n\n6\n6\nArthrobacter glacialis\n137\n3.655096\n2.874697\nTrue\n0.0\n0.017720\n\n\n7\n7\nArthrobacter glacialis\n158\n3.408169\n3.639039\nTrue\n20.0\n0.038055\n\n\n8\n8\nArthrobacter glacialis\n158\n3.431886\n3.888990\nTrue\n18.0\n0.048862\n\n\n9\n9\nArthrobacter glacialis\n158\n3.457496\n3.959770\nTrue\n16.0\n0.052445\n\n\n10\n10\nArthrobacter glacialis\n158\n3.470943\n4.004769\nTrue\n15.0\n0.054859\n\n\n11\n11\nArthrobacter glacialis\n158\n3.492705\n4.017891\nTrue\n13.0\n0.055584\n\n\n12\n12\nArthrobacter glacialis\n158\n3.528532\n3.928822\nTrue\n10.0\n0.050847\n\n\n13\n13\nArthrobacter glacialis\n158\n3.567542\n3.724600\nTrue\n7.0\n0.041455\n\n\n14\n14\nArthrobacter glacialis\n158\n3.607823\n3.462797\nTrue\n4.0\n0.031906\n\n\n15\n15\nArthrobacter glacialis\n158\n3.637232\n3.252033\nTrue\n2.0\n0.025843\n\n\n16\n16\nArthrobacter sp\n55\n3.254137\n5.044757\nFalse\n34.0\n0.155207\n\n\n17\n17\nArthrobacter sp\n55\n3.276011\n5.813081\nFalse\n32.0\n0.334649\n\n\n18\n18\nArthrobacter sp\n55\n3.301625\n5.909461\nFalse\n30.0\n0.368507\n\n\n19\n19\nArthrobacter sp\n55\n3.322757\n5.986574\nFalse\n28.0\n0.398048\n\n\n20\n20\nArthrobacter sp\n55\n3.363704\n5.897580\nFalse\n24.0\n0.364155\n\n\n21\n21\nArthrobacter sp\n55\n3.411676\n5.712691\nFalse\n20.0\n0.302684\n\n\n22\n22\nArthrobacter sp\n55\n3.460915\n5.431820\nFalse\n16.0\n0.228565\n\n\n23\n23\nArthrobacter sp\n55\n3.500546\n5.106008\nFalse\n13.0\n0.165010\n\n\n24\n24\nArthrobacter sp\n55\n3.549740\n4.524336\nFalse\n9.0\n0.092235\n\n\n25\n25\nArthrobacter sp\n55\n3.605948\n3.769969\nFalse\n4.0\n0.043379\n\n\n26\n26\nArthrobacter sp\n55\n3.657034\n2.996326\nFalse\n0.0\n0.020012\n\n\n27\n27\nArthrobacter sp\n60\n3.258599\n4.923223\nFalse\n34.0\n0.137445\n\n\n28\n28\nArthrobacter sp\n60\n3.277923\n5.761909\nFalse\n32.0\n0.317955\n\n\n29\n29\nArthrobacter sp\n60\n3.322746\n5.916174\nFalse\n28.0\n0.370989\n\n\n30\n30\nArthrobacter sp\n60\n3.363047\n5.788771\nFalse\n24.0\n0.326611\n\n\n31\n31\nArthrobacter sp\n60\n3.410359\n5.463071\nFalse\n20.0\n0.235821\n\n\n32\n32\nArthrobacter sp\n60\n3.460883\n5.220620\nFalse\n16.0\n0.185049\n\n\n33\n33\nArthrobacter sp\n60\n3.499878\n4.913998\nFalse\n13.0\n0.136183\n\n\n34\n34\nArthrobacter sp\n60\n3.549093\n4.479527\nFalse\n9.0\n0.088193\n\n\n35\n35\nArthrobacter sp\n60\n3.606580\n3.712378\nFalse\n4.0\n0.040951\n\n\n36\n36\nPseudomonas\n76\n3.252846\n4.967938\nFalse\n34.0\n0.143730\n\n\n37\n37\nPseudomonas\n76\n3.276656\n5.845091\nFalse\n32.0\n0.345534\n\n\n38\n38\nPseudomonas\n76\n3.302292\n6.088670\nFalse\n30.0\n0.440835\n\n\n39\n39\nPseudomonas\n76\n3.321507\n6.191355\nFalse\n28.0\n0.488508\n\n\n40\n40\nPseudomonas\n76\n3.351601\n6.287801\nFalse\n25.0\n0.537969\n\n\n41\n41\nPseudomonas\n76\n3.411068\n5.930282\nFalse\n20.0\n0.376261\n\n\n42\n42\nPseudomonas\n76\n3.531257\n5.042463\nFalse\n10.0\n0.154851\n\n\n43\n43\nPseudomonas\n76\n3.590712\n4.601743\nFalse\n5.0\n0.099658\n\n\n44\n44\nPseudomonas\n76\n3.627744\n4.013492\nFalse\n3.0\n0.055340"
  },
  {
    "objectID": "model_comparison/Gounot.html#fitting-temperature-response-curves-to-model",
    "href": "model_comparison/Gounot.html#fitting-temperature-response-curves-to-model",
    "title": "Gounot dataset of bacteria from glaciers",
    "section": "Fitting temperature response curves to model",
    "text": "Fitting temperature response curves to model\n\ndef nloglik(θ, Tdata, rdata, model=flexTPC):\n    params, σ2 = θ[:-1], θ[-1]\n    Tmin, Tmax = θ[:2]\n    outside = (Tdata &lt; Tmin) | (Tdata &gt; Tmax)\n    inside = ~outside\n    n = len(rdata[inside])\n    if np.any(rdata[outside] &gt; 0.0):\n        return np.inf\n    else:\n        return 0.5 * (n * np.log(2*np.pi*σ2) + np.sum((rdata[inside] - model(Tdata[inside], *params))**2 / σ2))\n    \ndef AIC(nll, p):\n    return 2 * nll + 2 * p \n\ndef BIC(nll, n, p):\n    return 2 * nll + p * np.log(n)\n\n\nstrains = [55, 60, 76, 137, 158]\n\ninitial_b1 = {55:[-5.0, 35.0, 0.0002, 0.01],\n              60:[-5.0, 35.0, 0.0002, 0.01],\n              76:[-5.0, 35.0, 0.0003, 0.01],\n             137:[-5.0, 22.0, 0.00008, 0.01],\n             158:[-5.0, 22.0, 0.00008, 0.01]}\n\ninitial_b2 = {55:[-5.0, 35.0, 0.0002, 2.0, 0.01],\n              60:[-5.0, 35.0, 0.0002, 2.0, 0.01],\n              76:[-5.0, 35.0, 0.0003, 2.0, 0.01],\n             137:[-5.0, 22.0, 0.00008, 2.0, 0.01],\n             158:[-5.0, 22.0, 0.00008, 2.0, 0.01]}\n\ninitial_flex = {55:[-5.0, 35.0, 0.4, 0.8, 0.2, 0.01],\n              60:[-5.0, 35.0, 0.4, 0.8, 0.2, 0.01],\n              76:[-5.0, 35.0, 0.6, 0.8, 0.2, 0.01],\n             137:[-5.0, 22.0, 0.05, 0.8, 0.2, 0.01],\n             158:[-5.0, 22.0, 0.05, 0.8, 0.2, 0.01]}\n\n\n# Check initial value curves.\nT = np.arange(-10, 40, 0.001)\n\nplt.figure(figsize=(4.33, 3), dpi=300)\n\nfor i, s in enumerate(strains):\n    subset = glacierbac[glacierbac[\"strain\"] == s]\n    species = list(subset[\"species\"])[0]\n    \n    plt.subplot(2, 3, i+1)\n    # Plot datapoints.\n    Tdata = subset[\"T\"]\n    rdata = subset[\"r\"]\n\n    plt.plot(Tdata, rdata, '^', markersize=5)\n    plt.xticks(fontsize=6)\n    plt.yticks(fontsize=6)\n    plt.xlim(-10, 37)\n    plt.ylim(0, max(rdata)*1.1)\n    \n    # Plot fitted curves by Briere.\n    #params = params_b1[s][\"x\"]\n    #plt.plot(T, briere1(T, *params[:-1]), color=\"firebrick\")\n    plt.plot(T, briere1(T, *initial_b1[s][:-1]), color=\"firebrick\")\n             \n    #params = params_eb[s][\"x\"]\n    #plt.plot(T, extbriere(T, *params[:-1]), color=\"steelblue\")\n    plt.plot(T, flexTPC(T, *initial_flex[s][:-1]), color=\"darkgreen\")\n\n    #plt.ylim(-0.025, 0.425)\n    plt.xlabel(\"Temperature [°C]\", fontsize=6)\n    plt.ylabel(\"Growth rate\", fontsize=6)\n    \n\n    \n    plt.title(species + \" \" + str(s), fontsize=6)\nplt.tight_layout()\n\n\n\n\n\n\n\n\n\n# LOOCV.\nloo = LeaveOneOut()\n\nparams = {\"flexTPC\":{}, \"b1\":{}, \"b2\":{}}\nmodels = [\"b1\", \"b2\", \"flexTPC\"]\nmethod = \"Nelder-Mead\"\nloocv_nll = {model:{strain:[] for strain in strains } for model in models}\n\nfor i, s in enumerate(strains):\n    subset = glacierbac[glacierbac[\"strain\"] == s]\n    Tdata = np.array(subset[\"T\"])\n    rdata = np.array(subset[\"r\"])\n    loo.get_n_splits(glacierbac[\"T\"][glacierbac[\"strain\"] == s])\n        \n    for train, test in loo.split(Tdata):\n        T_train, r_train = Tdata[train], rdata[train]\n        T_test, r_test = Tdata[test], rdata[test]\n        \n        params[\"b1\"][s] = minimize(nloglik, initial_b1[s],\n                                   bounds=[(-20.0, 20.0), \n                                           (10.0, 50.0), \n                                           (0.0, 1.0),  \n                                           (0, 1.0)],\n                          args=(T_train, r_train, briere1), options={\"maxiter\":10000}, method=method)\n        θ = params[\"b1\"][s][\"x\"]\n        loocv_nll[\"b1\"][s].append(nloglik(θ, T_test, r_test, model=briere1))\n        \n        params[\"b2\"][s] = minimize(nloglik, initial_b2[s],\n                                   bounds=[(-20.0, 20.0), \n                                           (10.0, 50.0), \n                                           (0.0, 1.0),\n                                           (0.0, 20.0),\n                                           (0, 1.0)],\n                          args=(Tdata, rdata, briere2), options={\"maxiter\":10000}, method=method)\n        θ = params[\"b2\"][s][\"x\"]\n        loocv_nll[\"b2\"][s].append(nloglik(θ, T_test, r_test, model=briere2))     \n        \n        params[\"flexTPC\"][s] = minimize(nloglik, initial_flex[s],\n                                        bounds=[(-20.0, 20.0), \n                                               (10.0, 50.0), \n                                               (0.0, 1.0),\n                                               (0.0, 1.0),\n                                               (0.0, np.inf),\n                                               (0, 1.0)],\n                          args=(Tdata, rdata, flexTPC), options={\"maxiter\":10000}, method=method)\n        θ = params[\"flexTPC\"][s][\"x\"]\n        loocv_nll[\"flexTPC\"][s].append(nloglik(θ, T_test, r_test, model=flexTPC))\n\n/var/folders/g8/wjqhnz1n01d5l4pdv8cnykw40000gp/T/ipykernel_14016/2868019315.py:10: RuntimeWarning: divide by zero encountered in log\n  return 0.5 * (n * np.log(2*np.pi*σ2) + np.sum((rdata[inside] - model(Tdata[inside], *params))**2 / σ2))\n/var/folders/g8/wjqhnz1n01d5l4pdv8cnykw40000gp/T/ipykernel_14016/2868019315.py:10: RuntimeWarning: divide by zero encountered in divide\n  return 0.5 * (n * np.log(2*np.pi*σ2) + np.sum((rdata[inside] - model(Tdata[inside], *params))**2 / σ2))\n/var/folders/g8/wjqhnz1n01d5l4pdv8cnykw40000gp/T/ipykernel_14016/2868019315.py:10: RuntimeWarning: invalid value encountered in scalar add\n  return 0.5 * (n * np.log(2*np.pi*σ2) + np.sum((rdata[inside] - model(Tdata[inside], *params))**2 / σ2))\n\n\n\n?minimize\n\n\n# Fit to whole datasets.\n\nparams = {\"b1\":{}, \"b2\":{}, \"flexTPC\":{}}\nmodels = [\"b1\", \"b2\", \"flexTPC\"]\nmethod = \"Nelder-Mead\"\nfor i, s in enumerate(strains):\n    subset = glacierbac[glacierbac[\"strain\"] == s]\n    Tdata = np.array(subset[\"T\"])\n    rdata = np.array(subset[\"r\"])    \n    \n\n    params[\"b1\"][s] = minimize(nloglik, initial_b1[s],\n                               bounds=[(-20.0, 20.0), \n                                           (10.0, 50.0), \n                                           (0.0, 1.0),  \n                                           (0, 1.0)],\n                      args=(Tdata, rdata, briere1), options={\"maxiter\":100000}, method=method)\n    params[\"b2\"][s] = minimize(nloglik, initial_b2[s],\n                               bounds=[(-20.0, 20.0), \n                                           (10.0, 50.0), \n                                           (0.0, 1.0),\n                                           (0.0, 20.0),\n                                           (0, 1.0)],\n                      args=(Tdata, rdata, briere2), options={\"maxiter\":100000}, method=method)\n    params[\"flexTPC\"][s] = minimize(nloglik, initial_flex[s],\n                                    bounds=[(-20.0, 20.0), \n                                               (10.0, 50.0), \n                                               (0.0, 1.0),\n                                               (0.0, 1.0),\n                                               (0.0, np.inf),\n                                               (0, 1.0)],\n                      args=(Tdata, rdata), options={\"maxiter\":100000}, method=method)\n\n/var/folders/g8/wjqhnz1n01d5l4pdv8cnykw40000gp/T/ipykernel_14016/2868019315.py:10: RuntimeWarning: divide by zero encountered in log\n  return 0.5 * (n * np.log(2*np.pi*σ2) + np.sum((rdata[inside] - model(Tdata[inside], *params))**2 / σ2))\n/var/folders/g8/wjqhnz1n01d5l4pdv8cnykw40000gp/T/ipykernel_14016/2868019315.py:10: RuntimeWarning: divide by zero encountered in divide\n  return 0.5 * (n * np.log(2*np.pi*σ2) + np.sum((rdata[inside] - model(Tdata[inside], *params))**2 / σ2))\n/var/folders/g8/wjqhnz1n01d5l4pdv8cnykw40000gp/T/ipykernel_14016/2868019315.py:10: RuntimeWarning: invalid value encountered in scalar add\n  return 0.5 * (n * np.log(2*np.pi*σ2) + np.sum((rdata[inside] - model(Tdata[inside], *params))**2 / σ2))\n\n\n\nparams[\"flexTPC\"]\n\n{55:        message: Optimization terminated successfully.\n        success: True\n         status: 0\n            fun: -39.65586276875569\n              x: [-9.778e+00  3.446e+01  3.967e-01  8.511e-01  1.914e-01\n                   4.331e-05]\n            nit: 376\n           nfev: 620\n  final_simplex: (array([[-9.778e+00,  3.446e+01, ...,  1.914e-01,\n                          4.331e-05],\n                        [-9.778e+00,  3.446e+01, ...,  1.914e-01,\n                          4.330e-05],\n                        ...,\n                        [-9.778e+00,  3.446e+01, ...,  1.914e-01,\n                          4.331e-05],\n                        [-9.778e+00,  3.446e+01, ...,  1.914e-01,\n                          4.330e-05]]), array([-3.966e+01, -3.966e+01, -3.966e+01, -3.966e+01,\n                        -3.966e+01, -3.966e+01, -3.966e+01])),\n 60:        message: Optimization terminated successfully.\n        success: True\n         status: 0\n            fun: -33.56410489101529\n              x: [-2.000e+01  3.426e+01  3.698e-01  9.001e-01  1.386e-01\n                   3.382e-05]\n            nit: 731\n           nfev: 1132\n  final_simplex: (array([[-2.000e+01,  3.426e+01, ...,  1.386e-01,\n                          3.382e-05],\n                        [-2.000e+01,  3.426e+01, ...,  1.386e-01,\n                          3.387e-05],\n                        ...,\n                        [-2.000e+01,  3.426e+01, ...,  1.386e-01,\n                          3.385e-05],\n                        [-2.000e+01,  3.426e+01, ...,  1.386e-01,\n                          3.384e-05]]), array([-3.356e+01, -3.356e+01, -3.356e+01, -3.356e+01,\n                        -3.356e+01, -3.356e+01, -3.356e+01])),\n 76:        message: Optimization terminated successfully.\n        success: True\n         status: 0\n            fun: -23.344804943246306\n              x: [-2.000e+01  3.482e+01  5.078e-01  8.481e-01  1.510e-01\n                   3.272e-04]\n            nit: 1149\n           nfev: 1740\n  final_simplex: (array([[-2.000e+01,  3.482e+01, ...,  1.510e-01,\n                          3.272e-04],\n                        [-2.000e+01,  3.482e+01, ...,  1.510e-01,\n                          3.273e-04],\n                        ...,\n                        [-2.000e+01,  3.482e+01, ...,  1.510e-01,\n                          3.273e-04],\n                        [-2.000e+01,  3.482e+01, ...,  1.510e-01,\n                          3.273e-04]]), array([-2.334e+01, -2.334e+01, -2.334e+01, -2.334e+01,\n                        -2.334e+01, -2.334e+01, -2.334e+01])),\n 137:        message: Optimization terminated successfully.\n        success: True\n         status: 0\n            fun: -31.206557942448455\n              x: [-9.353e+00  2.433e+01  5.088e-02  6.554e-01  2.325e-01\n                   7.856e-06]\n            nit: 388\n           nfev: 646\n  final_simplex: (array([[-9.353e+00,  2.433e+01, ...,  2.325e-01,\n                          7.856e-06],\n                        [-9.353e+00,  2.433e+01, ...,  2.325e-01,\n                          7.856e-06],\n                        ...,\n                        [-9.353e+00,  2.433e+01, ...,  2.325e-01,\n                          7.856e-06],\n                        [-9.353e+00,  2.433e+01, ...,  2.325e-01,\n                          7.856e-06]]), array([-3.121e+01, -3.121e+01, -3.121e+01, -3.121e+01,\n                        -3.121e+01, -3.121e+01, -3.121e+01])),\n 158:        message: Optimization terminated successfully.\n        success: True\n         status: 0\n            fun: -51.12053843952405\n              x: [-5.551e+00  2.333e+01  5.495e-02  6.703e-01  3.158e-01\n                   6.822e-07]\n            nit: 263\n           nfev: 439\n  final_simplex: (array([[-5.551e+00,  2.333e+01, ...,  3.158e-01,\n                          6.822e-07],\n                        [-5.551e+00,  2.333e+01, ...,  3.158e-01,\n                          6.819e-07],\n                        ...,\n                        [-5.551e+00,  2.333e+01, ...,  3.158e-01,\n                          6.824e-07],\n                        [-5.551e+00,  2.333e+01, ...,  3.158e-01,\n                          6.819e-07]]), array([-5.112e+01, -5.112e+01, -5.112e+01, -5.112e+01,\n                        -5.112e+01, -5.112e+01, -5.112e+01]))}\n\n\n\nT = np.arange(-10, 40, 0.001)\n\nfig, axarr = plt.subplots(2, 3, figsize=(6.5, 3), dpi=300, sharex=True, sharey='row')\n\n\nfor i, s in enumerate(strains):\n    ax = axarr[i // 3, i % 3]\n\n    subset = glacierbac[glacierbac[\"strain\"] == s]\n    species = list(subset[\"species\"])[0]\n    \n    # Plot datapoints.\n    Tdata = subset[\"T\"]\n    rdata = subset[\"r\"]\n\n    ax.plot(Tdata, rdata, '^', markersize=5)\n    ax.set_xticks([-10, 0, 10, 20, 30])\n    \n    ax.set_xlim(-10, 37)\n    \n    if s in (55, 60, 76):\n        #ax.set_ylim(0, round(max(rdata)*1.2, 1) )\n        #ax.set_yticks(fontsize=5)\n        ax.set_ylim(0, 0.6)\n    else:\n        ax.set_ylim(0, 0.06)\n        #ax.set_ylim(0, round(max(rdata)*1.1, 2) )\n    \n    # Plot fitted curves by Briere.\n    par = params[\"b1\"][s][\"x\"]\n    ax.plot(T, briere1(T, *par[:-1]), color=\"firebrick\", alpha=0.8)\n    \n    par = params[\"b2\"][s][\"x\"]\n    ax.plot(T, briere2(T, *par[:-1]), color=\"orange\", alpha=0.8)\n    \n    #par = params[\"rmb3\"][s][\"x\"]\n    #plt.plot(T, rmodbriere_3(T, *par[:-1]), color=\"blue\", alpha=0.7)\n    \n    #par = params[\"rmb4\"][s][\"x\"]\n    #plt.plot(T, rmodbriere_4(T, *par[:-1]), color=\"gray\", alpha=0.7)\n             \n    par = params[\"flexTPC\"][s][\"x\"]\n    ax.plot(T, flexTPC(T, *par[:-1]), color=\"darkgreen\", alpha=0.8)\n    \n\n    \n    ax.set_title(species + \" (\" + str(s) + \")\", fontsize=9)\n\n    if s in (137, 158):\n        ax.set_xlabel(\"Temperature [°C]\", fontsize=8)\n    if s in (55, 137):\n        ax.set_ylabel(r\"Growth rate [1 / h]\", fontsize=8)\n\naxarr[-1, -1].axis(\"off\")\n\nplt.tight_layout()\nfig.align_labels()\nplt.savefig(\"glacierbac.pdf\")\nplt.savefig(\"glacierbac.png\")\nplt.savefig(\"glacierbac.svg\")\n\n\n\n\n\n\n\n\n\nspecies_list = ['Arthrobacter sp', 'Arthrobacter sp', 'Pseudomonas', 'Arthrobacter glacialis', 'Arthrobacter glacialis']\nn_params = {'b1':4, 'b2':5, 'flexTPC':6} # Includes standard deviation.\nparam_matrix = {model:np.zeros((5, n_params[model])) for model in models}\n\nfor model in models:\n    for i, strain in enumerate(strains):\n        param_matrix[model][i, ] = params[model][strain][\"x\"]\n\ncolnames = {'b1':['Tmin', 'Tmax', 'c', 'sigma2'],\n            'b2':['Tmin', 'Tmax', 'c', 'm', 'sigma2'],\n            'flexTPC':['Tmin', 'Tmax', 'rmax', 'alpha', 'beta', 'sigma2']}\n\nparam_df = {model:pd.DataFrame(param_matrix[model], columns=colnames[model]) for model in models}\n\nfor model in models:\n    param_df[model]['strain'] = strains\n    param_df[model]['species'] = species_list\n    param_df[model] = param_df[model][['species', 'strain'] + colnames[model]]\n    param_df[model].to_csv(f'glacierbac_params_{model}.csv', index=False)\n\n\nparam_df['flexTPC']\n\n\n\n\n\n\n\n\nspecies\nstrain\nTmin\nTmax\nrmax\nalpha\nbeta\nsigma2\n\n\n\n\n0\nArthrobacter sp\n55\n-9.777811\n34.456556\n0.396684\n0.851142\n0.191401\n4.330609e-05\n\n\n1\nArthrobacter sp\n60\n-19.999030\n34.263106\n0.369805\n0.900109\n0.138623\n3.382453e-05\n\n\n2\nPseudomonas\n76\n-19.999933\n34.822869\n0.507802\n0.848116\n0.151044\n3.272288e-04\n\n\n3\nArthrobacter glacialis\n137\n-9.353280\n24.330746\n0.050876\n0.655434\n0.232482\n7.856058e-06\n\n\n4\nArthrobacter glacialis\n158\n-5.551258\n23.326786\n0.054946\n0.670261\n0.315771\n6.822184e-07\n\n\n\n\n\n\n\n\nspecies_list = list(set(glacierbac[\"species\"]))\n\n\nnll = np.zeros((len(strains), len(models)))\nloo_nll = np.zeros((len(strains), len(models)))\naic = np.zeros((len(strains), len(models)))\nbic = np.zeros((len(strains), len(models)))\np = [4, 5, 6] # Number of parameters\n\nfor i, s in enumerate(strains):\n    n = len(glacierbac[glacierbac[\"strain\"] == s]) # Number of datapoints.\n\n    for j, m in enumerate(models): \n        nll[i, j] = params[m][s][\"fun\"]\n        loo_nll[i, j] = np.mean(loocv_nll[m][s])\n        aic[i, j] = AIC(nll[i, j], p[j])\n        bic[i, j] = BIC(nll[i, j], n, p[j])\n\n\nlen(glacierbac)\n\n45\n\n\n\ndfAIC = pd.DataFrame(np.round(aic, 2), columns=models, index=strains)\ndfBIC = pd.DataFrame(np.round(bic, 2), columns=models, index=strains)\ndfLOOCV = pd.DataFrame(np.round(loo_nll, 2), columns=models, index=strains)\n\n\ndfAIC\n\n\n\n\n\n\n\n\nb1\nb2\nflexTPC\n\n\n\n\n55\n-60.66\n-63.68\n-67.31\n\n\n60\n-37.43\n-46.32\n-55.13\n\n\n76\n-31.86\n-30.17\n-34.69\n\n\n137\n-41.18\n-38.82\n-50.41\n\n\n158\n-52.02\n-64.14\n-90.24\n\n\n\n\n\n\n\n\ndfBIC\n\n\n\n\n\n\n\n\nb1\nb2\nflexTPC\n\n\n\n\n55\n-59.07\n-61.69\n-64.92\n\n\n60\n-36.64\n-45.33\n-53.94\n\n\n76\n-31.07\n-29.19\n-33.51\n\n\n137\n-41.40\n-39.09\n-50.74\n\n\n158\n-51.24\n-63.15\n-89.06\n\n\n\n\n\n\n\n\ndfLOOCV\n\n\n\n\n\n\n\n\nb1\nb2\nflexTPC\n\n\n\n\n55\n0.27\n-3.35\n-3.61\n\n\n60\n2.53\n-3.13\n-3.73\n\n\n76\ninf\n-2.23\n-2.59\n\n\n137\n-1.32\n-3.49\n-4.46\n\n\n158\ninf\n-4.12\n-5.68"
  },
  {
    "objectID": "model_comparison/Additional Figures.html",
    "href": "model_comparison/Additional Figures.html",
    "title": "Figure 1",
    "section": "",
    "text": "from matplotlib import pyplot as plt\n\nimport numpy as np\nimport pandas as pd\ndef briere1(T, Tmin=10.0, Tmax=40.0, c=0.001):\n    cond = (T &gt; Tmin) & (T &lt; Tmax)\n    r = np.zeros(len(T))\n    r[cond] = c * T[cond] * (T[cond] - Tmin) * np.sqrt(Tmax - T[cond])\n    return r\n\ndef briere2(T, Tmin=10.0, Tmax=50.0, c=1.0, m=2.0):\n    result = np.zeros(len(T))\n    cond = (Tmin &lt; T) & (T &lt; Tmax)\n    result[cond] = c * T[cond] * np.exp(np.log(T[cond] - Tmin) +  np.log(Tmax - T[cond]) / m)\n    return result\n\n# Fully biologically interpretable parametrization of flexTPC model\ndef flexTPC(T, Tmin=10.0, Tmax=40.0, rmax=1.0, α=0.8, β=0.2):\n    result = np.zeros(len(T))\n    cond = (Tmin &lt; T) & (T &lt; Tmax)\n    s = α * (1.0 - α) / β**2\n    result[cond] = rmax * np.exp(s * (α * (np.log(T[cond] - Tmin) - np.log(α)) +\n                                      (1 - α) * (np.log(Tmax - T[cond]) - np.log(1 - α) )\n                                       - np.log(Tmax - Tmin)))\n    return result\n\ndef flexTPCnd(τ, α=0.8, β=0.2):\n    s = α * (1.0 - α) / β**2\n    cond = (τ &gt; 0) & (τ &lt; 1)\n    r = np.zeros(len(τ))\n    r[cond] = np.exp(s * (α * (np.log(τ[cond]) - np.log(α)) + (1 - α) *  (np.log(1 - τ[cond]) - np.log(1-α))))\n    return r\ndef f1(τ, α, s, wref=np.exp(-1/8)):\n    return np.exp(np.log(α) + (1/ (α * s)) * np.log(wref) +((1-α)/(α)) * np.log((1-α)/(1-τ)))\n\ndef f2(τ, α, s, wref=np.exp(-1/8)):\n    return 1 - np.exp(np.log(1 - α) + (1/ ((1 - α) * s)) * np.log(wref) + (α / (1-α)) * np.log(α / τ))\n\n# Invert nondimensional flex numerically\ndef flexTPCroots(α, β, wref=np.exp(-1/8), err_tol=1e-3):\n    s = α * (1.0 - α) / β**2\n    τ1_prev = α * wref\n    τ2_prev = α + (1-α) * (1 - wref)\n\n    τ1 = f1(τ1_prev, α, s, wref=wref)\n    τ2 = f2(τ2_prev, α, s, wref=wref)\n    n_iter = 1\n    err = np.maximum(np.abs((τ1 - τ1_prev) / τ1_prev), np.abs((τ2 - τ2_prev) / τ2_prev))\n    while err &gt; err_tol:\n        τ1_prev = τ1\n        τ2_prev = τ2\n        τ1 = f1(τ1, α, s, wref=wref)\n        τ2 = f2(τ2, α, s, wref=wref)\n        err = np.maximum(np.abs((τ1 - τ1_prev) / τ1_prev), np.abs((τ2 - τ2_prev) / τ2_prev))\n        n_iter += 1\n    return τ1, τ2, n_iter, err"
  },
  {
    "objectID": "model_comparison/Additional Figures.html#panel-a",
    "href": "model_comparison/Additional Figures.html#panel-a",
    "title": "Figure 1",
    "section": "Panel A",
    "text": "Panel A\n\nτ = np.arange(0, 1.01, 0.01)\n\nfig, axarr = plt.subplots(4, 5)\n\nfor i, α in enumerate([0.01, 0.25, 0.5, 0.75, 0.99]):\n    for j, β in enumerate([0.03, 0.1, 0.4, 1.0]):\n        ax = axarr[j, i]\n        ax.plot(τ, flexTPCnd(τ, α=α, β=β))\n        \n        if (i == 2) and (j == 0):\n            ax.text(0.5, 1.5, r\"$\\alpha$\", fontsize=14)\n            ax.annotate('', xy=(-2.4, 1.25), xycoords='axes fraction',\n                       xytext=(3.4, 1.25), arrowprops=dict(arrowstyle='&lt;-', color='black'))\n            #ax.arrow(0, 2, 1, 0, clip_on=False)\n        \n        if (i == 0) and (j == 2):\n            ax.text(-0.65, 1.25, r\"$\\beta$\", fontsize=14)\n            ax.annotate('', xy=(-0.3, -1.25), xycoords='axes fraction',\n                       xytext=(-0.3, 3.35), arrowprops=dict(arrowstyle='-&gt;', color='black'))\n        # Hide X and Y axes label marks\n        ax.xaxis.set_tick_params(labelbottom=False)\n        ax.yaxis.set_tick_params(labelleft=False)\n\n        # Hide X and Y axes tick marks\n        ax.set_xticks([])\n        ax.set_yticks([])\n\nplt.tight_layout()\nplt.savefig(\"flexTPC_shapes.svg\")\nplt.show()\n\n/var/folders/g8/wjqhnz1n01d5l4pdv8cnykw40000gp/T/ipykernel_13589/1451454079.py:28: UserWarning: Tight layout not applied. tight_layout cannot make axes width small enough to accommodate all axes decorations\n  plt.tight_layout()\n\n\n\n\n\n\n\n\n\n\nfig, ax = plt.subplots(1, 1)\nT = np.arange(0, 50, 0.01)\n#Previously s=1\nα = 0.75\nβ = 0.4\nwref = np.exp(-1/8)\n\nplt.plot(T, flexTPC(T, α=α, β=β))\nplt.xlabel(r\"$T$\", fontsize=20)\nplt.ylabel(r\"$r(T)$\", fontsize=20)\n#plt.title(\"The flexTPC model\", fontsize=18)\n\n\n#plt.plot(10, 0, '.k')\nplt.text(10 + 0.5, 0.02, r\"$T_{\\min}$\", fontsize=18)\nplt.axvline(x=10, linestyle='--', color='black', linewidth=2)\n\n\n#plt.plot(40, 0, '.k')\nplt.text(40 - 4.0, 0.02, r\"$T_{\\max}$\", fontsize=18)\nplt.axvline(x=40, linestyle='--', color='black', linewidth=2)\n\n\n#plt.text(0.2* 10 + 0.8*40, 0.1, r\"$T_{\\mathrm{opt}}$\")\nplt.plot(0.25* 10 + 0.75*40, 1.0, '.k', markersize=10)\n\nplt.axvline(x=0.25* 10 + 0.75*40, linestyle='--', color='darkgreen', alpha=0.75, linewidth=2)\nplt.text(0.25* 10 + 0.75*40 - 14 - 2.5, 0.2, r\"$T_{\\mathrm{opt}} = \\alpha T_{\\max} + (1 - \\alpha) T_{\\min}$\",\n         fontsize=18, color='darkgreen')\n\nτ1, τ2, n_iter, err = flexTPCroots(α, β, wref=wref, err_tol=1e-10)\nT1 = τ1 * (40 - 10) + 10\nT2 = τ2 * (40 - 10) + 10\n\nplt.plot(T1, wref, '.k', markersize=10)\nplt.plot(T2, wref, '.k', markersize=10)\nplt.hlines(y=wref, xmin=T1, xmax=T2, \n            linestyle='--', color='orange', alpha=0.75, linewidth=2)\n\n\n\nplt.text(0.25* 10 + 0.75*40 - 9.5, 0.74, r\"$\\mathrm{UTB} \\approx \\beta (T_{\\max} - T_{\\min})$\",\n         fontsize=18, color='orange')\n\nplt.text(15, 0.95, r\"$r_{\\max}$\", fontsize=18)\nplt.axhline(y=1.0, linestyle='--', color='black', linewidth=2)\n\n\nplt.xlim(10 - 1, 40 + 1)\nplt.ylim(-0.001, 1.02)\nax = plt.gca()\n\n# Hide X and Y axes label marks\nax.xaxis.set_tick_params(labelbottom=False)\nax.yaxis.set_tick_params(labelleft=False)\n\n# Hide X and Y axes tick marks\nax.set_xticks([])\nax.set_yticks([])\n\nplt.savefig('scaling_params.svg')\nplt.show()"
  },
  {
    "objectID": "model_comparison/Additional Figures.html#figure-2",
    "href": "model_comparison/Additional Figures.html#figure-2",
    "title": "Figure 1",
    "section": "Figure 2",
    "text": "Figure 2\n\nmodels = ['b1', 'b2', 'flexTPC']\nlabel_name = {'b1': 'Briere1', 'b2': 'Briere2', 'flexTPC':'flexTPC'}\nmodel_r = {'b1':briere1, 'b2':briere2, 'flexTPC':flexTPC}\ncolor = {'b1':'firebrick',\n         'b2':'orange',\n         'flexTPC':'darkgreen'}\ndataset = {'botrana':pd.read_csv('briere_data_L_botrana.csv'),\n           'glacierbac':pd.read_csv('glacierbac.csv'),\n           'abcoli':pd.read_csv('ab_data.csv')}\ndataset['abcoli'] = dataset['abcoli'][dataset['abcoli'][\"drug2name\"] == \"WT\"] # Filter only single drugs\ndataset['abcoli'] = dataset['abcoli'].groupby([\"drug1name\", \"T\"], as_index=False).agg({'OD':'mean'}) # Calculate mean OD.\n\nfit_params = {'botrana':{model:pd.read_csv(f'botrana_params_{model}.csv') for model in models},\n              'glacierbac':{model:pd.read_csv(f'glacierbac_params_{model}.csv') for model in models},\n              'abcoli':{model:pd.read_csv(f'abcoli_params_{model}.csv') for model in models}}\ncurves_to_plot = {'botrana':[['eggs', 'instar 3', 'pupae'], \n                             ['eggs', 'i3', 'pupae']],\n                  'glacierbac':[['Pseudomonas (76)', 'Arthrobacter glacialis (137)', 'Arthrobacter glacialis (158)'], \n                                [76, 137, 158]],\n                  'abcoli':[['ERY', 'GEN', 'no drug'], \n                            ['ERY', 'GEN', 'WT']]}\n\nax_label_fontsize = 11\ntitle_fontsize = 12\n\nfig, axarr = plt.subplots(3, 3, figsize=(6.5*1.2, 5*1.2), sharex='col')\n\nT = np.arange(5, 36.5, 0.001)\ndata = dataset['botrana']\ni = 0\nfor plot_title, stage in zip(curves_to_plot['botrana'][0], curves_to_plot['botrana'][1]):\n    ax = axarr[i, 0]\n    ax.plot(data['T'], 1 / data[stage], '^', markersize=7)\n\n    for model in models:\n        params = fit_params['botrana'][model][fit_params['botrana'][model]['stage'] == stage]\n        ax.plot(T, model_r[model](T, *params.iloc[0, 1:-1]), color=color[model],\n               label=label_name[model])\n    if i == 2:\n        ax.set_xlabel(\"Temperature [°C]\", fontsize=ax_label_fontsize)\n    ax.set_xlim(5, 38)\n    ax.set_xticks([10, 20, 30])\n    ax.set_ylabel(\"Dev. rate [1 / day]\", fontsize=ax_label_fontsize)\n    ax.set_ylim(0, 1.25*np.max(1 / data[stage]))\n    ax.set_title(plot_title, fontsize=title_fontsize)\n    i += 1\n\n\nT = np.arange(-10, 40, 0.001)\ndata = dataset['glacierbac']\ni = 0\nfor plot_title, strain in zip(curves_to_plot['glacierbac'][0], curves_to_plot['glacierbac'][1]):\n    ax = axarr[i, 1]\n    subset = data[data['strain'] == strain]\n    ax.plot(subset['T'], subset[\"r\"], '^', markersize=7)\n    for model in models:\n        params = fit_params['glacierbac'][model][fit_params['glacierbac'][model]['strain'] == strain]\n        ax.plot(T, model_r[model](T, *params.iloc[0, 2:-1]), color=color[model])\n    if i == 2:\n        ax.set_xlabel(\"Temperature [°C]\", fontsize=ax_label_fontsize) \n    ax.set_xlim(-5, 38)\n    ax.set_xticks([0, 10, 20, 30])\n    \n    ax.set_ylabel(\"Growth rate [1 / h]\", fontsize=ax_label_fontsize )\n    ax.set_ylim(0, 1.25*np.max(subset[\"r\"]) )\n    \n    ax.set_title(plot_title, fontsize=title_fontsize)\n    i += 1\n\n\nT = np.arange(10, 50, 0.001)\ndata = dataset['abcoli']\ni = 0\nfor plot_title, drug in zip(curves_to_plot['abcoli'][0], curves_to_plot['abcoli'][1]):\n    ax = axarr[i, 2]\n    subset = data[(data['drug1name'] == drug)]\n    ax.plot(subset['T'], subset[\"OD\"], '^', markersize=7)\n    for model in models:\n        params = fit_params['abcoli'][model][fit_params['abcoli'][model]['drug'] == drug]\n        ax.plot(T, model_r[model](T, *params.iloc[0, 1:-1]), color=color[model], label=label_name[model])\n    if i == 0:\n        ax.legend(fontsize=8, loc='upper left', fancybox=True, framealpha=0.5)\n    if i == 2:\n        ax.set_xlabel(\"Temperature [°C]\", fontsize=ax_label_fontsize)\n    ax.set_ylabel(\"OD\", fontsize=ax_label_fontsize )\n    ax.set_xticks([10, 20, 30, 40, 50])\n    #ax.set_yticks([0, 0.2, 0.4, 0.6, 0.8])\n    ax.set_ylim(0, 1.3*np.max(subset[\"OD\"]) )\n    ax.set_title(plot_title, fontsize=title_fontsize)\n    i += 1\n\n\nfig.align_ylabels()\n\nplt.tight_layout(w_pad=4.5)\n\nplt.savefig(\"TPC_examples.svg\")\nplt.savefig(\"TPC_examples.png\")\nplt.savefig(\"TPC_examples.pdf\")"
  }
]